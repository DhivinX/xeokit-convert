/*! For license information please see xeokit-convert.cjs.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.convert2xkt=t():e.convert2xkt=t()}(global,(()=>(()=>{"use strict";var e={231:e=>{e.exports=require("fs")}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,r),i.exports}r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};return(()=>{r.r(n),r.d(n,{ClampToEdgeWrapping:()=>p,GIFMediaType:()=>O,JPEGMediaType:()=>L,LinearFilter:()=>M,LinearMipMapLinearFilter:()=>A,LinearMipMapNearestFilter:()=>I,LinearMipmapLinearFilter:()=>S,LinearMipmapNearestFilter:()=>T,MirroredRepeatWrapping:()=>m,NearestFilter:()=>y,NearestMipMapLinearFilter:()=>w,NearestMipMapNearestFilter:()=>g,NearestMipmapLinearFilter:()=>b,NearestMipmapNearestFilter:()=>x,PNGMediaType:()=>P,RepeatWrapping:()=>d,XKTModel:()=>He,XKT_INFO:()=>f,buildBoxGeometry:()=>zr,buildBoxLinesGeometry:()=>Ur,buildCylinderGeometry:()=>Xr,buildGridGeometry:()=>Rr,buildPlaneGeometry:()=>Kr,buildSphereGeometry:()=>qr,buildTorusGeometry:()=>Zr,buildVectorTextGeometry:()=>Wr,convert2xkt:()=>tn,parseCityJSONIntoXKTModel:()=>Ft,parseGLTFIntoXKTModel:()=>Wt,parseGLTFJSONIntoXKTModel:()=>ar,parseIFCIntoXKTModel:()=>vr,parseLASIntoXKTModel:()=>wr,parseMetaModelIntoXKTModel:()=>Mr,parsePCDIntoXKTModel:()=>Tr,parsePLYIntoXKTModel:()=>Lr,parseSTLIntoXKTModel:()=>kr,writeXKTModelToArrayBuffer:()=>nt});const e=require("@loaders.gl/polyfills");var t,o,i,a,s,u,c,l,h,f={xktVersion:10},d=1e3,p=1001,m=1002,y=1003,g=1004,x=1004,b=1005,w=1005,M=1006,T=1007,I=1007,S=1008,A=1008,O=1e4,L=10001,P=10002,E=Float64Array,j=new E(16),G=new E(16),k=new E(4),_={MIN_DOUBLE:-Number.MAX_SAFE_INTEGER,MAX_DOUBLE:Number.MAX_SAFE_INTEGER,DEGTORAD:.0174532925,RADTODEG:57.295779513,vec2:function(e){return new E(e||2)},vec3:function(e){return new E(e||3)},vec4:function(e){return new E(e||4)},mat3:function(e){return new E(e||9)},mat3ToMat4:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new E(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=0,t[4]=e[3],t[5]=e[4],t[6]=e[5],t[7]=0,t[8]=e[6],t[9]=e[7],t[10]=e[8],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},mat4:function(e){return new E(e||16)},mat4ToMat3:function(e,t){},createUUID:function(){for(var e=[],t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16);return function(){var t=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0,o=4294967295*Math.random()|0;return"".concat(e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255],"-").concat(e[255&r]).concat(e[r>>8&255],"-").concat(e[r>>16&15|64]).concat(e[r>>24&255],"-").concat(e[63&n|128]).concat(e[n>>8&255],"-").concat(e[n>>16&255]).concat(e[n>>24&255]).concat(e[255&o]).concat(e[o>>8&255]).concat(e[o>>16&255]).concat(e[o>>24&255])}}(),clamp:function(e,t,r){return Math.max(t,Math.min(r,e))},fmod:function(e,t){if(e<t)return console.error("math.fmod : Attempting to find modulus within negative range - would be infinite loop - ignoring"),e;for(;t<=e;)e-=t;return e},negateVec4:function(e,t){return t||(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},addVec4:function(e,t,r){return r||(r=e),r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r[3]=e[3]+t[3],r},addVec4Scalar:function(e,t,r){return r||(r=e),r[0]=e[0]+t,r[1]=e[1]+t,r[2]=e[2]+t,r[3]=e[3]+t,r},addVec3:function(e,t,r){return r||(r=e),r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r},addVec3Scalar:function(e,t,r){return r||(r=e),r[0]=e[0]+t,r[1]=e[1]+t,r[2]=e[2]+t,r},subVec4:function(e,t,r){return r||(r=e),r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r[3]=e[3]-t[3],r},subVec3:function(e,t,r){return r||(r=e),r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r},subVec2:function(e,t,r){return r||(r=e),r[0]=e[0]-t[0],r[1]=e[1]-t[1],r},subVec4Scalar:function(e,t,r){return r||(r=e),r[0]=e[0]-t,r[1]=e[1]-t,r[2]=e[2]-t,r[3]=e[3]-t,r},subScalarVec4:function(e,t,r){return r||(r=e),r[0]=t-e[0],r[1]=t-e[1],r[2]=t-e[2],r[3]=t-e[3],r},mulVec4:function(e,t,r){return r||(r=e),r[0]=e[0]*t[0],r[1]=e[1]*t[1],r[2]=e[2]*t[2],r[3]=e[3]*t[3],r},mulVec4Scalar:function(e,t,r){return r||(r=e),r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r[3]=e[3]*t,r},mulVec3Scalar:function(e,t,r){return r||(r=e),r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r},mulVec2Scalar:function(e,t,r){return r||(r=e),r[0]=e[0]*t,r[1]=e[1]*t,r},divVec3:function(e,t,r){return r||(r=e),r[0]=e[0]/t[0],r[1]=e[1]/t[1],r[2]=e[2]/t[2],r},divVec4:function(e,t,r){return r||(r=e),r[0]=e[0]/t[0],r[1]=e[1]/t[1],r[2]=e[2]/t[2],r[3]=e[3]/t[3],r},divScalarVec3:function(e,t,r){return r||(r=t),r[0]=e/t[0],r[1]=e/t[1],r[2]=e/t[2],r},divVec3Scalar:function(e,t,r){return r||(r=e),r[0]=e[0]/t,r[1]=e[1]/t,r[2]=e[2]/t,r},divVec4Scalar:function(e,t,r){return r||(r=e),r[0]=e[0]/t,r[1]=e[1]/t,r[2]=e[2]/t,r[3]=e[3]/t,r},divScalarVec4:function(e,t,r){return r||(r=t),r[0]=e/t[0],r[1]=e/t[1],r[2]=e/t[2],r[3]=e/t[3],r},dotVec4:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},cross3Vec4:function(e,t){var r=e[0],n=e[1],o=e[2],i=t[0],a=t[1],s=t[2];return[n*s-o*a,o*i-r*s,r*a-n*i,0]},cross3Vec3:function(e,t,r){r||(r=e);var n=e[0],o=e[1],i=e[2],a=t[0],s=t[1],u=t[2];return r[0]=o*u-i*s,r[1]=i*a-n*u,r[2]=n*s-o*a,r},sqLenVec4:function(e){return _.dotVec4(e,e)},lenVec4:function(e){return Math.sqrt(_.sqLenVec4(e))},dotVec3:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},dotVec2:function(e,t){return e[0]*t[0]+e[1]*t[1]},sqLenVec3:function(e){return _.dotVec3(e,e)},sqLenVec2:function(e){return _.dotVec2(e,e)},lenVec3:function(e){return Math.sqrt(_.sqLenVec3(e))},distVec3:(c=new E(3),function(e,t){return _.lenVec3(_.subVec3(e,t,c))}),lenVec2:function(e){return Math.sqrt(_.sqLenVec2(e))},distVec2:function(){var e=new E(2);return function(t,r){return _.lenVec2(_.subVec2(t,r,e))}}(),rcpVec3:function(e,t){return _.divScalarVec3(1,e,t)},normalizeVec4:function(e,t){var r=1/_.lenVec4(e);return _.mulVec4Scalar(e,r,t)},normalizeVec3:function(e,t){var r=1/_.lenVec3(e);return _.mulVec3Scalar(e,r,t)},normalizeVec2:function(e,t){var r=1/_.lenVec2(e);return _.mulVec2Scalar(e,r,t)},angleVec3:function(e,t){var r=_.dotVec3(e,t)/Math.sqrt(_.sqLenVec3(e)*_.sqLenVec3(t));return r=r<-1?-1:r>1?1:r,Math.acos(r)},vec3FromMat4Scale:(u=new E(3),function(e,t){return u[0]=e[0],u[1]=e[1],u[2]=e[2],t[0]=_.lenVec3(u),u[0]=e[4],u[1]=e[5],u[2]=e[6],t[1]=_.lenVec3(u),u[0]=e[8],u[1]=e[9],u[2]=e[10],t[2]=_.lenVec3(u),t}),vecToArray:function(){function e(e){return Math.round(1e5*e)/1e5}return function(t){for(var r=0,n=(t=Array.prototype.slice.call(t)).length;r<n;r++)t[r]=e(t[r]);return t}}(),xyzArrayToObject:function(e){return{x:e[0],y:e[1],z:e[2]}},xyzObjectToArray:function(e,t){return(t=t||new E(3))[0]=e.x,t[1]=e.y,t[2]=e.z,t},dupMat4:function(e){return e.slice(0,16)},mat4To3:function(e){return[e[0],e[1],e[2],e[4],e[5],e[6],e[8],e[9],e[10]]},m4s:function(e){return[e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e]},setMat4ToZeroes:function(){return _.m4s(0)},setMat4ToOnes:function(){return _.m4s(1)},diagonalMat4v:function(e){return new E([e[0],0,0,0,0,e[1],0,0,0,0,e[2],0,0,0,0,e[3]])},diagonalMat4c:function(e,t,r,n){return _.diagonalMat4v([e,t,r,n])},diagonalMat4s:function(e){return _.diagonalMat4c(e,e,e,e)},identityMat4:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new E(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},identityMat3:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new E(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},isIdentityMat4:function(e){return 1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&0===e[12]&&0===e[13]&&0===e[14]&&1===e[15]},negateMat4:function(e,t){return t||(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=-e[7],t[8]=-e[8],t[9]=-e[9],t[10]=-e[10],t[11]=-e[11],t[12]=-e[12],t[13]=-e[13],t[14]=-e[14],t[15]=-e[15],t},addMat4:function(e,t,r){return r||(r=e),r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r[3]=e[3]+t[3],r[4]=e[4]+t[4],r[5]=e[5]+t[5],r[6]=e[6]+t[6],r[7]=e[7]+t[7],r[8]=e[8]+t[8],r[9]=e[9]+t[9],r[10]=e[10]+t[10],r[11]=e[11]+t[11],r[12]=e[12]+t[12],r[13]=e[13]+t[13],r[14]=e[14]+t[14],r[15]=e[15]+t[15],r},addMat4Scalar:function(e,t,r){return r||(r=e),r[0]=e[0]+t,r[1]=e[1]+t,r[2]=e[2]+t,r[3]=e[3]+t,r[4]=e[4]+t,r[5]=e[5]+t,r[6]=e[6]+t,r[7]=e[7]+t,r[8]=e[8]+t,r[9]=e[9]+t,r[10]=e[10]+t,r[11]=e[11]+t,r[12]=e[12]+t,r[13]=e[13]+t,r[14]=e[14]+t,r[15]=e[15]+t,r},addScalarMat4:function(e,t,r){return _.addMat4Scalar(t,e,r)},subMat4:function(e,t,r){return r||(r=e),r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r[3]=e[3]-t[3],r[4]=e[4]-t[4],r[5]=e[5]-t[5],r[6]=e[6]-t[6],r[7]=e[7]-t[7],r[8]=e[8]-t[8],r[9]=e[9]-t[9],r[10]=e[10]-t[10],r[11]=e[11]-t[11],r[12]=e[12]-t[12],r[13]=e[13]-t[13],r[14]=e[14]-t[14],r[15]=e[15]-t[15],r},subMat4Scalar:function(e,t,r){return r||(r=e),r[0]=e[0]-t,r[1]=e[1]-t,r[2]=e[2]-t,r[3]=e[3]-t,r[4]=e[4]-t,r[5]=e[5]-t,r[6]=e[6]-t,r[7]=e[7]-t,r[8]=e[8]-t,r[9]=e[9]-t,r[10]=e[10]-t,r[11]=e[11]-t,r[12]=e[12]-t,r[13]=e[13]-t,r[14]=e[14]-t,r[15]=e[15]-t,r},subScalarMat4:function(e,t,r){return r||(r=t),r[0]=e-t[0],r[1]=e-t[1],r[2]=e-t[2],r[3]=e-t[3],r[4]=e-t[4],r[5]=e-t[5],r[6]=e-t[6],r[7]=e-t[7],r[8]=e-t[8],r[9]=e-t[9],r[10]=e-t[10],r[11]=e-t[11],r[12]=e-t[12],r[13]=e-t[13],r[14]=e-t[14],r[15]=e-t[15],r},mulMat4:function(e,t,r){r||(r=e);var n=e[0],o=e[1],i=e[2],a=e[3],s=e[4],u=e[5],c=e[6],l=e[7],h=e[8],f=e[9],d=e[10],p=e[11],v=e[12],m=e[13],y=e[14],g=e[15],x=t[0],b=t[1],w=t[2],M=t[3],T=t[4],I=t[5],S=t[6],A=t[7],O=t[8],L=t[9],P=t[10],E=t[11],j=t[12],G=t[13],k=t[14],_=t[15];return r[0]=x*n+b*s+w*h+M*v,r[1]=x*o+b*u+w*f+M*m,r[2]=x*i+b*c+w*d+M*y,r[3]=x*a+b*l+w*p+M*g,r[4]=T*n+I*s+S*h+A*v,r[5]=T*o+I*u+S*f+A*m,r[6]=T*i+I*c+S*d+A*y,r[7]=T*a+I*l+S*p+A*g,r[8]=O*n+L*s+P*h+E*v,r[9]=O*o+L*u+P*f+E*m,r[10]=O*i+L*c+P*d+E*y,r[11]=O*a+L*l+P*p+E*g,r[12]=j*n+G*s+k*h+_*v,r[13]=j*o+G*u+k*f+_*m,r[14]=j*i+G*c+k*d+_*y,r[15]=j*a+G*l+k*p+_*g,r},mulMat3:function(e,t,r){r||(r=new E(9));var n=e[0],o=e[3],i=e[6],a=e[1],s=e[4],u=e[7],c=e[2],l=e[5],h=e[8],f=t[0],d=t[3],p=t[6],v=t[1],m=t[4],y=t[7],g=t[2],x=t[5],b=t[8];return r[0]=n*f+o*v+i*g,r[3]=n*d+o*m+i*x,r[6]=n*p+o*y+i*b,r[1]=a*f+s*v+u*g,r[4]=a*d+s*m+u*x,r[7]=a*p+s*y+u*b,r[2]=c*f+l*v+h*g,r[5]=c*d+l*m+h*x,r[8]=c*p+l*y+h*b,r},mulMat4Scalar:function(e,t,r){return r||(r=e),r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r[3]=e[3]*t,r[4]=e[4]*t,r[5]=e[5]*t,r[6]=e[6]*t,r[7]=e[7]*t,r[8]=e[8]*t,r[9]=e[9]*t,r[10]=e[10]*t,r[11]=e[11]*t,r[12]=e[12]*t,r[13]=e[13]*t,r[14]=e[14]*t,r[15]=e[15]*t,r},mulMat4v4:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:_.vec4(),n=t[0],o=t[1],i=t[2],a=t[3];return r[0]=e[0]*n+e[4]*o+e[8]*i+e[12]*a,r[1]=e[1]*n+e[5]*o+e[9]*i+e[13]*a,r[2]=e[2]*n+e[6]*o+e[10]*i+e[14]*a,r[3]=e[3]*n+e[7]*o+e[11]*i+e[15]*a,r},transposeMat4:function(e,t){var r=e[4],n=e[14],o=e[8],i=e[13],a=e[12],s=e[9];if(!t||e===t){var u=e[1],c=e[2],l=e[3],h=e[6],f=e[7],d=e[11];return e[1]=r,e[2]=o,e[3]=a,e[4]=u,e[6]=s,e[7]=i,e[8]=c,e[9]=h,e[11]=n,e[12]=l,e[13]=f,e[14]=d,e}return t[0]=e[0],t[1]=r,t[2]=o,t[3]=a,t[4]=e[1],t[5]=e[5],t[6]=s,t[7]=i,t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=n,t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15],t},transposeMat3:function(e,t){if(t===e){var r=e[1],n=e[2],o=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=n,t[7]=o}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},determinantMat4:function(e){var t=e[0],r=e[1],n=e[2],o=e[3],i=e[4],a=e[5],s=e[6],u=e[7],c=e[8],l=e[9],h=e[10],f=e[11],d=e[12],p=e[13],v=e[14],m=e[15];return d*l*s*o-c*p*s*o-d*a*h*o+i*p*h*o+c*a*v*o-i*l*v*o-d*l*n*u+c*p*n*u+d*r*h*u-t*p*h*u-c*r*v*u+t*l*v*u+d*a*n*f-i*p*n*f-d*r*s*f+t*p*s*f+i*r*v*f-t*a*v*f-c*a*n*m+i*l*n*m+c*r*s*m-t*l*s*m-i*r*h*m+t*a*h*m},inverseMat4:function(e,t){t||(t=e);var r=e[0],n=e[1],o=e[2],i=e[3],a=e[4],s=e[5],u=e[6],c=e[7],l=e[8],h=e[9],f=e[10],d=e[11],p=e[12],v=e[13],m=e[14],y=e[15],g=r*s-n*a,x=r*u-o*a,b=r*c-i*a,w=n*u-o*s,M=n*c-i*s,T=o*c-i*u,I=l*v-h*p,S=l*m-f*p,A=l*y-d*p,O=h*m-f*v,L=h*y-d*v,P=f*y-d*m,E=1/(g*P-x*L+b*O+w*A-M*S+T*I);return t[0]=(s*P-u*L+c*O)*E,t[1]=(-n*P+o*L-i*O)*E,t[2]=(v*T-m*M+y*w)*E,t[3]=(-h*T+f*M-d*w)*E,t[4]=(-a*P+u*A-c*S)*E,t[5]=(r*P-o*A+i*S)*E,t[6]=(-p*T+m*b-y*x)*E,t[7]=(l*T-f*b+d*x)*E,t[8]=(a*L-s*A+c*I)*E,t[9]=(-r*L+n*A-i*I)*E,t[10]=(p*M-v*b+y*g)*E,t[11]=(-l*M+h*b-d*g)*E,t[12]=(-a*O+s*S-u*I)*E,t[13]=(r*O-n*S+o*I)*E,t[14]=(-p*w+v*x-m*g)*E,t[15]=(l*w-h*x+f*g)*E,t},traceMat4:function(e){return e[0]+e[5]+e[10]+e[15]},translationMat4v:function(e,t){var r=t||_.identityMat4();return r[12]=e[0],r[13]=e[1],r[14]=e[2],r},translationMat3v:function(e,t){var r=t||_.identityMat3();return r[6]=e[0],r[7]=e[1],r},translationMat4c:(s=new E(3),function(e,t,r,n){return s[0]=e,s[1]=t,s[2]=r,_.translationMat4v(s,n)}),translationMat4s:function(e,t){return _.translationMat4c(e,e,e,t)},translateMat4v:function(e,t){return _.translateMat4c(e[0],e[1],e[2],t)},OLDtranslateMat4c:function(e,t,r,n){var o=n[12];n[0]+=o*e,n[4]+=o*t,n[8]+=o*r;var i=n[13];n[1]+=i*e,n[5]+=i*t,n[9]+=i*r;var a=n[14];n[2]+=a*e,n[6]+=a*t,n[10]+=a*r;var s=n[15];return n[3]+=s*e,n[7]+=s*t,n[11]+=s*r,n},translateMat4c:function(e,t,r,n){var o=n[3];n[0]+=o*e,n[1]+=o*t,n[2]+=o*r;var i=n[7];n[4]+=i*e,n[5]+=i*t,n[6]+=i*r;var a=n[11];n[8]+=a*e,n[9]+=a*t,n[10]+=a*r;var s=n[15];return n[12]+=s*e,n[13]+=s*t,n[14]+=s*r,n},rotationMat4v:function(e,t,r){var n,o,i,a,s,u,c=_.normalizeVec4([t[0],t[1],t[2],0],[]),l=Math.sin(e),h=Math.cos(e),f=1-h,d=c[0],p=c[1],v=c[2];return n=d*p,o=p*v,i=v*d,a=d*l,s=p*l,u=v*l,(r=r||_.mat4())[0]=f*d*d+h,r[1]=f*n+u,r[2]=f*i-s,r[3]=0,r[4]=f*n-u,r[5]=f*p*p+h,r[6]=f*o+a,r[7]=0,r[8]=f*i+s,r[9]=f*o-a,r[10]=f*v*v+h,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},rotationMat4c:function(e,t,r,n,o){return _.rotationMat4v(e,[t,r,n],o)},scalingMat4v:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_.identityMat4();return t[0]=e[0],t[5]=e[1],t[10]=e[2],t},scalingMat3v:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_.identityMat3();return t[0]=e[0],t[4]=e[1],t},scalingMat4c:function(){var e=new E(3);return function(t,r,n,o){return e[0]=t,e[1]=r,e[2]=n,_.scalingMat4v(e,o)}}(),scaleMat4c:function(e,t,r,n){return n[0]*=e,n[4]*=t,n[8]*=r,n[1]*=e,n[5]*=t,n[9]*=r,n[2]*=e,n[6]*=t,n[10]*=r,n[3]*=e,n[7]*=t,n[11]*=r,n},scaleMat4v:function(e,t){var r=e[0],n=e[1],o=e[2];return t[0]*=r,t[4]*=n,t[8]*=o,t[1]*=r,t[5]*=n,t[9]*=o,t[2]*=r,t[6]*=n,t[10]*=o,t[3]*=r,t[7]*=n,t[11]*=o,t},scalingMat4s:function(e){return _.scalingMat4c(e,e,e)},rotationTranslationMat4:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:_.mat4(),n=e[0],o=e[1],i=e[2],a=e[3],s=n+n,u=o+o,c=i+i,l=n*s,h=n*u,f=n*c,d=o*u,p=o*c,v=i*c,m=a*s,y=a*u,g=a*c;return r[0]=1-(d+v),r[1]=h+g,r[2]=f-y,r[3]=0,r[4]=h-g,r[5]=1-(l+v),r[6]=p+m,r[7]=0,r[8]=f+y,r[9]=p-m,r[10]=1-(l+d),r[11]=0,r[12]=t[0],r[13]=t[1],r[14]=t[2],r[15]=1,r},mat4ToEuler:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:_.vec4(),n=_.clamp,o=e[0],i=e[4],a=e[8],s=e[1],u=e[5],c=e[9],l=e[2],h=e[6],f=e[10];return"XYZ"===t?(r[1]=Math.asin(n(a,-1,1)),Math.abs(a)<.99999?(r[0]=Math.atan2(-c,f),r[2]=Math.atan2(-i,o)):(r[0]=Math.atan2(h,u),r[2]=0)):"YXZ"===t?(r[0]=Math.asin(-n(c,-1,1)),Math.abs(c)<.99999?(r[1]=Math.atan2(a,f),r[2]=Math.atan2(s,u)):(r[1]=Math.atan2(-l,o),r[2]=0)):"ZXY"===t?(r[0]=Math.asin(n(h,-1,1)),Math.abs(h)<.99999?(r[1]=Math.atan2(-l,f),r[2]=Math.atan2(-i,u)):(r[1]=0,r[2]=Math.atan2(s,o))):"ZYX"===t?(r[1]=Math.asin(-n(l,-1,1)),Math.abs(l)<.99999?(r[0]=Math.atan2(h,f),r[2]=Math.atan2(s,o)):(r[0]=0,r[2]=Math.atan2(-i,u))):"YZX"===t?(r[2]=Math.asin(n(s,-1,1)),Math.abs(s)<.99999?(r[0]=Math.atan2(-c,u),r[1]=Math.atan2(-l,o)):(r[0]=0,r[1]=Math.atan2(a,f))):"XZY"===t&&(r[2]=Math.asin(-n(i,-1,1)),Math.abs(i)<.99999?(r[0]=Math.atan2(h,u),r[1]=Math.atan2(a,o)):(r[0]=Math.atan2(-c,f),r[1]=0)),r},composeMat4:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:_.mat4();return _.quaternionToRotationMat4(t,n),_.scaleMat4v(r,n),_.translateMat4v(e,n),n},decomposeMat4:function(){var e=new E(3),t=new E(16);return function(r,n,o,i){e[0]=r[0],e[1]=r[1],e[2]=r[2];var a=_.lenVec3(e);e[0]=r[4],e[1]=r[5],e[2]=r[6];var s=_.lenVec3(e);e[8]=r[8],e[9]=r[9],e[10]=r[10];var u=_.lenVec3(e);_.determinantMat4(r)<0&&(a=-a),n[0]=r[12],n[1]=r[13],n[2]=r[14],t.set(r);var c=1/a,l=1/s,h=1/u;return t[0]*=c,t[1]*=c,t[2]*=c,t[4]*=l,t[5]*=l,t[6]*=l,t[8]*=h,t[9]*=h,t[10]*=h,_.mat4ToQuaternion(t,o),i[0]=a,i[1]=s,i[2]=u,this}}(),lookAtMat4v:function(e,t,r,n){n||(n=_.mat4());var o,i,a,s,u,c,l,h,f,d,p=e[0],v=e[1],m=e[2],y=r[0],g=r[1],x=r[2],b=t[0],w=t[1],M=t[2];return p===b&&v===w&&m===M?_.identityMat4():(o=p-b,i=v-w,a=m-M,s=g*(a*=d=1/Math.sqrt(o*o+i*i+a*a))-x*(i*=d),u=x*(o*=d)-y*a,c=y*i-g*o,(d=Math.sqrt(s*s+u*u+c*c))?(s*=d=1/d,u*=d,c*=d):(s=0,u=0,c=0),l=i*c-a*u,h=a*s-o*c,f=o*u-i*s,(d=Math.sqrt(l*l+h*h+f*f))?(l*=d=1/d,h*=d,f*=d):(l=0,h=0,f=0),n[0]=s,n[1]=l,n[2]=o,n[3]=0,n[4]=u,n[5]=h,n[6]=i,n[7]=0,n[8]=c,n[9]=f,n[10]=a,n[11]=0,n[12]=-(s*p+u*v+c*m),n[13]=-(l*p+h*v+f*m),n[14]=-(o*p+i*v+a*m),n[15]=1,n)},lookAtMat4c:function(e,t,r,n,o,i,a,s,u){return _.lookAtMat4v([e,t,r],[n,o,i],[a,s,u],[])},orthoMat4c:function(e,t,r,n,o,i,a){a||(a=_.mat4());var s=t-e,u=n-r,c=i-o;return a[0]=2/s,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2/u,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=-2/c,a[11]=0,a[12]=-(e+t)/s,a[13]=-(n+r)/u,a[14]=-(i+o)/c,a[15]=1,a},frustumMat4v:function(e,t,r){r||(r=_.mat4());var n=[e[0],e[1],e[2],0],o=[t[0],t[1],t[2],0];_.addVec4(o,n,j),_.subVec4(o,n,G);var i=2*n[2],a=G[0],s=G[1],u=G[2];return r[0]=i/a,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=i/s,r[6]=0,r[7]=0,r[8]=j[0]/a,r[9]=j[1]/s,r[10]=-j[2]/u,r[11]=-1,r[12]=0,r[13]=0,r[14]=-i*o[2]/u,r[15]=0,r},frustumMat4:function(e,t,r,n,o,i,a){a||(a=_.mat4());var s=t-e,u=n-r,c=i-o;return a[0]=2*o/s,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2*o/u,a[6]=0,a[7]=0,a[8]=(t+e)/s,a[9]=(n+r)/u,a[10]=-(i+o)/c,a[11]=-1,a[12]=0,a[13]=0,a[14]=-i*o*2/c,a[15]=0,a},perspectiveMat4:function(e,t,r,n,o){var i=[],a=[];return i[2]=r,a[2]=n,a[1]=i[2]*Math.tan(e/2),i[1]=-a[1],a[0]=a[1]*t,i[0]=-a[0],_.frustumMat4v(i,a,o)},transformPoint3:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:_.vec3(),n=t[0],o=t[1],i=t[2];return r[0]=e[0]*n+e[4]*o+e[8]*i+e[12],r[1]=e[1]*n+e[5]*o+e[9]*i+e[13],r[2]=e[2]*n+e[6]*o+e[10]*i+e[14],r},transformPoint4:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:_.vec4();return r[0]=e[0]*t[0]+e[4]*t[1]+e[8]*t[2]+e[12]*t[3],r[1]=e[1]*t[0]+e[5]*t[1]+e[9]*t[2]+e[13]*t[3],r[2]=e[2]*t[0]+e[6]*t[1]+e[10]*t[2]+e[14]*t[3],r[3]=e[3]*t[0]+e[7]*t[1]+e[11]*t[2]+e[15]*t[3],r},transformPoints3:function(e,t,r){for(var n,o,i,a,s,u=r||[],c=t.length,l=e[0],h=e[1],f=e[2],d=e[3],p=e[4],v=e[5],m=e[6],y=e[7],g=e[8],x=e[9],b=e[10],w=e[11],M=e[12],T=e[13],I=e[14],S=e[15],A=0;A<c;++A)n=(a=t[A])[0],o=a[1],i=a[2],(s=u[A]||(u[A]=[0,0,0]))[0]=l*n+p*o+g*i+M,s[1]=h*n+v*o+x*i+T,s[2]=f*n+m*o+b*i+I,s[3]=d*n+y*o+w*i+S;return u.length=c,u},transformPositions3:function(e,t){var r,n,o,i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t,s=t.length,u=e[0],c=e[1],l=e[2],h=e[3],f=e[4],d=e[5],p=e[6],v=e[7],m=e[8],y=e[9],g=e[10],x=e[11],b=e[12],w=e[13],M=e[14],T=e[15];for(r=0;r<s;r+=3)n=t[r+0],o=t[r+1],i=t[r+2],a[r+0]=u*n+f*o+m*i+b,a[r+1]=c*n+d*o+y*i+w,a[r+2]=l*n+p*o+g*i+M,a[r+3]=h*n+v*o+x*i+T;return a},transformPositions4:function(e,t){var r,n,o,i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t,s=t.length,u=e[0],c=e[1],l=e[2],h=e[3],f=e[4],d=e[5],p=e[6],v=e[7],m=e[8],y=e[9],g=e[10],x=e[11],b=e[12],w=e[13],M=e[14],T=e[15];for(r=0;r<s;r+=4)n=t[r+0],o=t[r+1],i=t[r+2],a[r+0]=u*n+f*o+m*i+b,a[r+1]=c*n+d*o+y*i+w,a[r+2]=l*n+p*o+g*i+M,a[r+3]=h*n+v*o+x*i+T;return a},transformVec3:function(e,t,r){var n=t[0],o=t[1],i=t[2];return(r=r||this.vec3())[0]=e[0]*n+e[4]*o+e[8]*i,r[1]=e[1]*n+e[5]*o+e[9]*i,r[2]=e[2]*n+e[6]*o+e[10]*i,r},transformVec4:function(e,t,r){var n=t[0],o=t[1],i=t[2],a=t[3];return(r=r||_.vec4())[0]=e[0]*n+e[4]*o+e[8]*i+e[12]*a,r[1]=e[1]*n+e[5]*o+e[9]*i+e[13]*a,r[2]=e[2]*n+e[6]*o+e[10]*i+e[14]*a,r[3]=e[3]*n+e[7]*o+e[11]*i+e[15]*a,r},rotateVec3X:function(e,t,r,n){var o=[],i=[];return o[0]=e[0]-t[0],o[1]=e[1]-t[1],o[2]=e[2]-t[2],i[0]=o[0],i[1]=o[1]*Math.cos(r)-o[2]*Math.sin(r),i[2]=o[1]*Math.sin(r)+o[2]*Math.cos(r),n[0]=i[0]+t[0],n[1]=i[1]+t[1],n[2]=i[2]+t[2],n},rotateVec3Y:function(e,t,r,n){var o=[],i=[];return o[0]=e[0]-t[0],o[1]=e[1]-t[1],o[2]=e[2]-t[2],i[0]=o[2]*Math.sin(r)+o[0]*Math.cos(r),i[1]=o[1],i[2]=o[2]*Math.cos(r)-o[0]*Math.sin(r),n[0]=i[0]+t[0],n[1]=i[1]+t[1],n[2]=i[2]+t[2],n},rotateVec3Z:function(e,t,r,n){var o=[],i=[];return o[0]=e[0]-t[0],o[1]=e[1]-t[1],o[2]=e[2]-t[2],i[0]=o[0]*Math.cos(r)-o[1]*Math.sin(r),i[1]=o[0]*Math.sin(r)+o[1]*Math.cos(r),i[2]=o[2],n[0]=i[0]+t[0],n[1]=i[1]+t[1],n[2]=i[2]+t[2],n},projectVec4:function(e,t){var r=1/e[3];return(t=t||_.vec2())[0]=v[0]*r,t[1]=v[1]*r,t},unprojectVec3:(o=new E(16),i=new E(16),a=new E(16),function(e,t,r,n){return this.transformVec3(this.mulMat4(this.inverseMat4(t,o),this.inverseMat4(r,i),a),e,n)}),lerpVec3:function(e,t,r,n,o,i){var a=i||_.vec3(),s=(e-t)/(r-t);return a[0]=n[0]+s*(o[0]-n[0]),a[1]=n[1]+s*(o[1]-n[1]),a[2]=n[2]+s*(o[2]-n[2]),a},flatten:function(e){var t,r,n,o,i,a=[];for(t=0,r=e.length;t<r;t++)for(n=0,o=(i=e[t]).length;n<o;n++)a.push(i[n]);return a},identityQuaternion:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_.vec4();return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},eulerToQuaternion:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:_.vec4(),n=e[0]*_.DEGTORAD/2,o=e[1]*_.DEGTORAD/2,i=e[2]*_.DEGTORAD/2,a=Math.cos(n),s=Math.cos(o),u=Math.cos(i),c=Math.sin(n),l=Math.sin(o),h=Math.sin(i);return"XYZ"===t?(r[0]=c*s*u+a*l*h,r[1]=a*l*u-c*s*h,r[2]=a*s*h+c*l*u,r[3]=a*s*u-c*l*h):"YXZ"===t?(r[0]=c*s*u+a*l*h,r[1]=a*l*u-c*s*h,r[2]=a*s*h-c*l*u,r[3]=a*s*u+c*l*h):"ZXY"===t?(r[0]=c*s*u-a*l*h,r[1]=a*l*u+c*s*h,r[2]=a*s*h+c*l*u,r[3]=a*s*u-c*l*h):"ZYX"===t?(r[0]=c*s*u-a*l*h,r[1]=a*l*u+c*s*h,r[2]=a*s*h-c*l*u,r[3]=a*s*u+c*l*h):"YZX"===t?(r[0]=c*s*u+a*l*h,r[1]=a*l*u+c*s*h,r[2]=a*s*h-c*l*u,r[3]=a*s*u-c*l*h):"XZY"===t&&(r[0]=c*s*u-a*l*h,r[1]=a*l*u-c*s*h,r[2]=a*s*h+c*l*u,r[3]=a*s*u+c*l*h),r},mat4ToQuaternion:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_.vec4(),n=e[0],o=e[4],i=e[8],a=e[1],s=e[5],u=e[9],c=e[2],l=e[6],h=e[10],f=n+s+h;return f>0?(t=.5/Math.sqrt(f+1),r[3]=.25/t,r[0]=(l-u)*t,r[1]=(i-c)*t,r[2]=(a-o)*t):n>s&&n>h?(t=2*Math.sqrt(1+n-s-h),r[3]=(l-u)/t,r[0]=.25*t,r[1]=(o+a)/t,r[2]=(i+c)/t):s>h?(t=2*Math.sqrt(1+s-n-h),r[3]=(i-c)/t,r[0]=(o+a)/t,r[1]=.25*t,r[2]=(u+l)/t):(t=2*Math.sqrt(1+h-n-s),r[3]=(a-o)/t,r[0]=(i+c)/t,r[1]=(u+l)/t,r[2]=.25*t),r},vec3PairToQuaternion:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:_.vec4(),n=Math.sqrt(_.dotVec3(e,e)*_.dotVec3(t,t)),o=n+_.dotVec3(e,t);return o<1e-8*n?(o=0,Math.abs(e[0])>Math.abs(e[2])?(r[0]=-e[1],r[1]=e[0],r[2]=0):(r[0]=0,r[1]=-e[2],r[2]=e[1])):_.cross3Vec3(e,t,r),r[3]=o,_.normalizeQuaternion(r)},angleAxisToQuaternion:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_.vec4(),r=e[3]/2,n=Math.sin(r);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(r),t},quaternionToEuler:function(){var e=new E(16);return function(t,r,n){return n=n||_.vec3(),_.quaternionToRotationMat4(t,e),_.mat4ToEuler(e,r,n),n}}(),mulQuaternions:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:_.vec4(),n=e[0],o=e[1],i=e[2],a=e[3],s=t[0],u=t[1],c=t[2],l=t[3];return r[0]=a*s+n*l+o*c-i*u,r[1]=a*u+o*l+i*s-n*c,r[2]=a*c+i*l+n*u-o*s,r[3]=a*l-n*s-o*u-i*c,r},vec3ApplyQuaternion:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:_.vec3(),n=t[0],o=t[1],i=t[2],a=e[0],s=e[1],u=e[2],c=e[3],l=c*n+s*i-u*o,h=c*o+u*n-a*i,f=c*i+a*o-s*n,d=-a*n-s*o-u*i;return r[0]=l*c+d*-a+h*-u-f*-s,r[1]=h*c+d*-s+f*-a-l*-u,r[2]=f*c+d*-u+l*-s-h*-a,r},quaternionToMat4:function(e,t){t=_.identityMat4(t);var r=e[0],n=e[1],o=e[2],i=e[3],a=2*r,s=2*n,u=2*o,c=a*i,l=s*i,h=u*i,f=a*r,d=s*r,p=u*r,v=s*n,m=u*n,y=u*o;return t[0]=1-(v+y),t[1]=d+h,t[2]=p-l,t[4]=d-h,t[5]=1-(f+y),t[6]=m+c,t[8]=p+l,t[9]=m-c,t[10]=1-(f+v),t},quaternionToRotationMat4:function(e,t){var r=e[0],n=e[1],o=e[2],i=e[3],a=r+r,s=n+n,u=o+o,c=r*a,l=r*s,h=r*u,f=n*s,d=n*u,p=o*u,v=i*a,m=i*s,y=i*u;return t[0]=1-(f+p),t[4]=l-y,t[8]=h+m,t[1]=l+y,t[5]=1-(c+p),t[9]=d-v,t[2]=h-m,t[6]=d+v,t[10]=1-(c+f),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},normalizeQuaternion:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,r=_.lenVec4([e[0],e[1],e[2],e[3]]);return t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r,t[3]=e[3]/r,t},conjugateQuaternion:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},inverseQuaternion:function(e,t){return _.normalizeQuaternion(_.conjugateQuaternion(e,t))},quaternionToAngleAxis:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_.vec4(),r=(e=_.normalizeQuaternion(e,k))[3],n=2*Math.acos(r),o=Math.sqrt(1-r*r);return o<.001?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=e[0]/o,t[1]=e[1]/o,t[2]=e[2]/o),t[3]=n,t},AABB3:function(e){return new E(e||6)},AABB2:function(e){return new E(e||4)},OBB3:function(e){return new E(e||32)},OBB2:function(e){return new E(e||16)},Sphere3:function(e,t,r,n){return new E([e,t,r,n])},transformOBB3:function(e,t){var r,n,o,i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t,s=t.length,u=e[0],c=e[1],l=e[2],h=e[3],f=e[4],d=e[5],p=e[6],v=e[7],m=e[8],y=e[9],g=e[10],x=e[11],b=e[12],w=e[13],M=e[14],T=e[15];for(r=0;r<s;r+=4)n=t[r+0],o=t[r+1],i=t[r+2],a[r+0]=u*n+f*o+m*i+b,a[r+1]=c*n+d*o+y*i+w,a[r+2]=l*n+p*o+g*i+M,a[r+3]=h*n+v*o+x*i+T;return a},containsAABB3:function(e,t){return e[0]<=t[0]&&t[3]<=e[3]&&e[1]<=t[1]&&t[4]<=e[4]&&e[2]<=t[2]&&t[5]<=e[5]},getAABB3Diag:function(){var e=new E(3),t=new E(3),r=new E(3);return function(n){return e[0]=n[0],e[1]=n[1],e[2]=n[2],t[0]=n[3],t[1]=n[4],t[2]=n[5],_.subVec3(t,e,r),Math.abs(_.lenVec3(r))}}(),getAABB3DiagPoint:function(){var e=new E(3),t=new E(3),r=new E(3);return function(n,o){e[0]=n[0],e[1]=n[1],e[2]=n[2],t[0]=n[3],t[1]=n[4],t[2]=n[5];var i=_.subVec3(t,e,r),a=o[0]-n[0],s=n[3]-o[0],u=o[1]-n[1],c=n[4]-o[1],l=o[2]-n[2],h=n[5]-o[2];return i[0]+=a>s?a:s,i[1]+=u>c?u:c,i[2]+=l>h?l:h,Math.abs(_.lenVec3(i))}}(),getAABB3Center:function(e,t){var r=t||_.vec3();return r[0]=(e[0]+e[3])/2,r[1]=(e[1]+e[4])/2,r[2]=(e[2]+e[5])/2,r},getAABB2Center:function(e,t){var r=t||_.vec2();return r[0]=(e[2]+e[0])/2,r[1]=(e[3]+e[1])/2,r},collapseAABB3:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_.AABB3();return e[0]=_.MAX_DOUBLE,e[1]=_.MAX_DOUBLE,e[2]=_.MAX_DOUBLE,e[3]=-_.MAX_DOUBLE,e[4]=-_.MAX_DOUBLE,e[5]=-_.MAX_DOUBLE,e},AABB3ToOBB3:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_.OBB3();return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=1,t[4]=e[3],t[5]=e[1],t[6]=e[2],t[7]=1,t[8]=e[3],t[9]=e[4],t[10]=e[2],t[11]=1,t[12]=e[0],t[13]=e[4],t[14]=e[2],t[15]=1,t[16]=e[0],t[17]=e[1],t[18]=e[5],t[19]=1,t[20]=e[3],t[21]=e[1],t[22]=e[5],t[23]=1,t[24]=e[3],t[25]=e[4],t[26]=e[5],t[27]=1,t[28]=e[0],t[29]=e[4],t[30]=e[5],t[31]=1,t},positions3ToAABB3:(t=new E(3),function(e,r,n){r=r||_.AABB3();for(var o,i,a,s=_.MAX_DOUBLE,u=_.MAX_DOUBLE,c=_.MAX_DOUBLE,l=-_.MAX_DOUBLE,h=-_.MAX_DOUBLE,f=-_.MAX_DOUBLE,d=0,p=e.length;d<p;d+=3)n?(t[0]=e[d+0],t[1]=e[d+1],t[2]=e[d+2],_.decompressPosition(t,n,t),o=t[0],i=t[1],a=t[2]):(o=e[d+0],i=e[d+1],a=e[d+2]),o<s&&(s=o),i<u&&(u=i),a<c&&(c=a),o>l&&(l=o),i>h&&(h=i),a>f&&(f=a);return r[0]=s,r[1]=u,r[2]=c,r[3]=l,r[4]=h,r[5]=f,r}),OBB3ToAABB3:function(e){for(var t,r,n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_.AABB3(),i=_.MAX_DOUBLE,a=_.MAX_DOUBLE,s=_.MAX_DOUBLE,u=-_.MAX_DOUBLE,c=-_.MAX_DOUBLE,l=-_.MAX_DOUBLE,h=0,f=e.length;h<f;h+=4)(t=e[h+0])<i&&(i=t),(r=e[h+1])<a&&(a=r),(n=e[h+2])<s&&(s=n),t>u&&(u=t),r>c&&(c=r),n>l&&(l=n);return o[0]=i,o[1]=a,o[2]=s,o[3]=u,o[4]=c,o[5]=l,o},points3ToAABB3:function(e){for(var t,r,n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_.AABB3(),i=_.MAX_DOUBLE,a=_.MAX_DOUBLE,s=_.MAX_DOUBLE,u=-_.MAX_DOUBLE,c=-_.MAX_DOUBLE,l=-_.MAX_DOUBLE,h=0,f=e.length;h<f;h++)(t=e[h][0])<i&&(i=t),(r=e[h][1])<a&&(a=r),(n=e[h][2])<s&&(s=n),t>u&&(u=t),r>c&&(c=r),n>l&&(l=n);return o[0]=i,o[1]=a,o[2]=s,o[3]=u,o[4]=c,o[5]=l,o},points3ToSphere3:function(){var e=new E(3);return function(t,r){r=r||_.vec4();var n,o=0,i=0,a=0,s=t.length;for(n=0;n<s;n++)o+=t[n][0],i+=t[n][1],a+=t[n][2];r[0]=o/s,r[1]=i/s,r[2]=a/s;var u,c=0;for(n=0;n<s;n++)(u=Math.abs(_.lenVec3(_.subVec3(t[n],r,e))))>c&&(c=u);return r[3]=c,r}}(),positions3ToSphere3:function(){var e=new E(3),t=new E(3);return function(r,n){n=n||_.vec4();var o,i=0,a=0,s=0,u=r.length,c=0;for(o=0;o<u;o+=3)i+=r[o],a+=r[o+1],s+=r[o+2];var l,h=u/3;for(n[0]=i/h,n[1]=a/h,n[2]=s/h,o=0;o<u;o+=3)e[0]=r[o],e[1]=r[o+1],e[2]=r[o+2],(l=Math.abs(_.lenVec3(_.subVec3(e,n,t))))>c&&(c=l);return n[3]=c,n}}(),OBB3ToSphere3:function(){var e=new E(3),t=new E(3);return function(r,n){n=n||_.vec4();var o,i=0,a=0,s=0,u=r.length,c=u/4;for(o=0;o<u;o+=4)i+=r[o+0],a+=r[o+1],s+=r[o+2];n[0]=i/c,n[1]=a/c,n[2]=s/c;var l,h=0;for(o=0;o<u;o+=4)e[0]=r[o+0],e[1]=r[o+1],e[2]=r[o+2],(l=Math.abs(_.lenVec3(_.subVec3(e,n,t))))>h&&(h=l);return n[3]=h,n}}(),getSphere3Center:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_.vec3();return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},expandAABB3:function(e,t){return e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]>t[2]&&(e[2]=t[2]),e[3]<t[3]&&(e[3]=t[3]),e[4]<t[4]&&(e[4]=t[4]),e[5]<t[5]&&(e[5]=t[5]),e},expandAABB3Point3:function(e,t){return e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]>t[2]&&(e[2]=t[2]),e[3]<t[0]&&(e[3]=t[0]),e[4]<t[1]&&(e[4]=t[1]),e[5]<t[2]&&(e[5]=t[2]),e},triangleNormal:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:_.vec3(),o=t[0]-e[0],i=t[1]-e[1],a=t[2]-e[2],s=r[0]-e[0],u=r[1]-e[1],c=r[2]-e[2],l=i*c-a*u,h=a*s-o*c,f=o*u-i*s,d=Math.sqrt(l*l+h*h+f*f);return 0===d?(n[0]=0,n[1]=0,n[2]=0):(n[0]=l/d,n[1]=h/d,n[2]=f/d),n}};function D(e,t,r,n){var o=e[t]/(Math.abs(e[t])+Math.abs(e[t+1])+Math.abs(e[t+2])),i=e[t+1]/(Math.abs(e[t])+Math.abs(e[t+1])+Math.abs(e[t+2]));if(e[t+2]<0){var a=(1-Math.abs(i))*(o>=0?1:-1),s=(1-Math.abs(o))*(i>=0?1:-1);o=a,i=s}return new Int8Array([Math[r](127.5*o+(o<0?-1:0)),Math[n](127.5*i+(i<0?-1:0))])}function N(e){var t=e[0],r=e[1];t/=t<0?127:128,r/=r<0?127:128;var n=1-Math.abs(t)-Math.abs(r);n<0&&(t=(1-Math.abs(r))*(t>=0?1:-1),r=(1-Math.abs(t))*(r>=0?1:-1));var o=Math.sqrt(t*t+r*r+n*n);return[t/o,r/o,n/o]}function F(e,t,r){return e[t]*r[0]+e[t+1]*r[1]+e[t+2]*r[2]}var V,C,B,z,U,X,R,K,q,Z,Y,W,Q,J,H,$,ee,te={quantizePositions:function(e,t,r,n){for(var o=r[0],i=r[1],a=r[2],s=65535,u=s/(r[3]-o),c=s/(r[4]-i),l=s/(r[5]-a),h=function(e){return e>=0?e:0},f=0;f<t;f+=3)n[f+0]=Math.max(0,Math.min(65535,Math.floor(h(e[f+0]-o)*u))),n[f+1]=Math.max(0,Math.min(65535,Math.floor(h(e[f+1]-i)*c))),n[f+2]=Math.max(0,Math.min(65535,Math.floor(h(e[f+2]-a)*l)))},compressPosition:function(e,t,r){var n=new Float32Array([t[3]!==t[0]?65535/(t[3]-t[0]):0,t[4]!==t[1]?65535/(t[4]-t[1]):0,t[5]!==t[2]?65535/(t[5]-t[2]):0]);r[0]=Math.max(0,Math.min(65535,Math.floor((e[0]-t[0])*n[0]))),r[1]=Math.max(0,Math.min(65535,Math.floor((e[1]-t[1])*n[1]))),r[2]=Math.max(0,Math.min(65535,Math.floor((e[2]-t[2])*n[2])))},createPositionsDecodeMatrix:(l=_.mat4(),h=_.mat4(),function(e,t){t=t||_.mat4();var r=e[0],n=e[1],o=e[2],i=e[3]-r,a=e[4]-n,s=e[5]-o,u=65535;return _.identityMat4(l),_.translationMat4v(e,l),_.identityMat4(h),_.scalingMat4v([i/u,a/u,s/u],h),_.mulMat4(l,h,t),t}),transformAndOctEncodeNormals:function(e,t,r,n,o){var i,a,s,u,c,l=_.vec3(),h=_.vec3();for(c=0;c<r;c+=3)l[0]=t[c],l[1]=t[c+1],l[2]=t[c+2],_.transformVec3(e,l,h),_.normalizeVec3(h,h),a=i=D(h,0,"floor","floor"),s=u=F(h,0,N(i)),(s=F(h,0,N(i=D(h,0,"ceil","floor"))))>u&&(a=i,u=s),(s=F(h,0,N(i=D(h,0,"floor","ceil"))))>u&&(a=i,u=s),(s=F(h,0,N(i=D(h,0,"ceil","ceil"))))>u&&(a=i,u=s),n[o+c+0]=a[0],n[o+c+1]=a[1],n[o+c+2]=0;return o+r},octEncodeNormals:function(e,t,r,n){for(var o,i,a,s,u=0;u<t;u+=3)i=o=D(e,u,"floor","floor"),a=s=F(e,u,N(o)),(a=F(e,u,N(o=D(e,u,"ceil","floor"))))>s&&(i=o,s=a),(a=F(e,u,N(o=D(e,u,"floor","ceil"))))>s&&(i=o,s=a),(a=F(e,u,N(o=D(e,u,"ceil","ceil"))))>s&&(i=o,s=a),r[n+u+0]=i[0],r[n+u+1]=i[1],r[n+u+2]=0;return n+t}},re=(V=[],C=[],B=[],z=[],U=[],X=0,R=new Uint16Array(3),K=new Uint16Array(3),q=new Uint16Array(3),Z=_.vec3(),Y=_.vec3(),W=_.vec3(),Q=_.vec3(),J=_.vec3(),H=_.vec3(),$=_.vec3(),ee=_.vec3(),function(e,t,r,n){!function(e,t){var r,n,o,i,a,s,u={},c=Math.pow(10,4),l=0;for(a=0,s=e.length;a<s;a+=3)r=e[a],n=e[a+1],o=e[a+2],void 0===u[i=Math.round(r*c)+"_"+Math.round(n*c)+"_"+Math.round(o*c)]&&(u[i]=l/3,V[l++]=r,V[l++]=n,V[l++]=o),C[a/3]=u[i];for(a=0,s=t.length;a<s;a++)z[a]=C[t[a]],B[z[a]]=t[a]}(e,t),function(e,t){X=0;for(var r=0,n=e;r<n;r+=3){var o=3*z[r],i=3*z[r+1],a=3*z[r+2];t?(R[0]=V[o],R[1]=V[o+1],R[2]=V[o+2],K[0]=V[i],K[1]=V[i+1],K[2]=V[i+2],q[0]=V[a],q[1]=V[a+1],q[2]=V[a+2],_.decompressPosition(R,t,Z),_.decompressPosition(K,t,Y),_.decompressPosition(q,t,W)):(Z[0]=V[o],Z[1]=V[o+1],Z[2]=V[o+2],Y[0]=V[i],Y[1]=V[i+1],Y[2]=V[i+2],W[0]=V[a],W[1]=V[a+1],W[2]=V[a+2]),_.subVec3(W,Y,Q),_.subVec3(Z,Y,J),_.cross3Vec3(Q,J,H),_.normalizeVec3(H,$);var s=U[X]||(U[X]={normal:_.vec3()});s.normal[0]=$[0],s.normal[1]=$[1],s.normal[2]=$[2],X++}}(t.length,r);for(var o,i,a,s,u,c,l,h,f,d,p,v=[],m=Math.cos(_.DEGTORAD*n),y={},g=!1,x=0,b=t.length;x<b;x+=3)for(var w=x/3,M=0;M<3;M++)o=z[x+M],i=z[x+(M+1)%3],void 0===y[u=(a=Math.min(o,i))+","+(s=Math.max(o,i))]?y[u]={index1:a,index2:s,face1:w,face2:void 0}:y[u].face2=w;for(u in y){if(void 0!==(c=y[u]).face2){l=U[c.face1].normal,h=U[c.face2].normal,ee[0]=-h[0],ee[1]=-h[1],ee[2]=-h[2],f=Math.abs(_.dotVec3(l,h));var T=Math.abs(_.dotVec3(l,ee));if(f>m&&T>m)continue}d=B[c.index1],p=B[c.index2],(!g&&d>65535||p>65535)&&(g=!0),v.push(d),v.push(p)}return g?new Uint32Array(v):new Uint16Array(v)}),ne=function(e,t,r,n){function o(e,r){for(var n,o,i=0;i<3;i++)if((n=t[3*e+i])!==(o=t[3*r+i]))return o-n;return 0}for(var i=e.slice().sort(o),a=null,s=0,u=i.length;s<u;s++)0!=s&&0==o(i[s],i[s-1])||(a=i[s]),r[i[s]]=a;for(var c=0,l=e.length;c<l;c+=3){var h=r[e[c]],f=r[e[c+1]],d=r[e[c+2]],p=h,v=f,m=d;if(h>f&&h>d?f>d?(p=h,v=f,m=d):(p=h,v=d,m=f):f>h&&f>d?h>d?(p=f,v=h,m=d):(p=f,v=d,m=h):d>h&&d>f&&(h>f?(p=d,v=h,m=f):(p=d,v=f,m=h)),n[c+0]=[p,v],n[c+1]=[v,m],p>m){var y=m;m=p,p=y}n[c+2]=[m,p]}function g(e,t){for(var r,n,o=0;o<2;o++)if(r=e[o],(n=t[o])!==r)return n-r;return 0}(n=n.slice(0,e.length)).sort(g);for(var x=0,b=0;b<n.length;b++)if(0===b||0!==g(n[b],n[b-1])){if(0!==b&&2!==x)return!1;x=1}else x++;return!(n.length>0&&2!==x)};function oe(e){return oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},oe(e)}function ie(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==oe(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==oe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===oe(o)?o:String(o)),n)}var o}function ae(e,t,r){return t&&ie(e.prototype,t),r&&ie(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}var se=ae((function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.meshId=t.meshId,this.meshIndex=t.meshIndex,this.matrix=t.matrix,this.geometry=t.geometry,this.color=t.color||new Float32Array([1,1,1]),this.metallic=null!==t.metallic&&void 0!==t.metallic?t.metallic:0,this.roughness=null!==t.roughness&&void 0!==t.roughness?t.roughness:1,this.opacity=void 0!==t.opacity&&null!==t.opacity?t.opacity:1,this.textureSet=t.textureSet,this.entity=null}));function ue(e){return ue="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ue(e)}function ce(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==ue(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==ue(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===ue(o)?o:String(o)),n)}var o}var le=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.geometryId=t.geometryId,this.primitiveType=t.primitiveType,this.geometryIndex=t.geometryIndex,this.numInstances=0,this.positions=t.positions,this.positionsQuantized=new Uint16Array(t.positions.length),this.normals=t.normals,this.normalsOctEncoded=null,this.colorsCompressed=t.colorsCompressed,this.uvs=t.uvs,this.uvsCompressed=t.uvsCompressed,this.indices=t.indices,this.edgeIndices=t.edgeIndices,this.solid=!1}var t,r;return t=e,(r=[{key:"reused",get:function(){return this.numInstances>1}}])&&ce(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function he(e){return he="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},he(e)}function fe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==he(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==he(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===he(o)?o:String(o)),n)}var o}function de(e,t,r){return t&&fe(e.prototype,t),r&&fe(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}var pe=de((function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.entityId=t,this.entityIndex=null,this.meshes=r,this.aabb=_.AABB3(),this.hasReusedGeometries=!1}));function ve(e){return ve="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ve(e)}function me(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==ve(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==ve(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===ve(o)?o:String(o)),n)}var o}function ye(e,t,r){return t&&me(e.prototype,t),r&&me(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}var ge=ye((function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.aabb=t,this.entities=r}));function xe(e){return xe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},xe(e)}function be(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==xe(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==xe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===xe(o)?o:String(o)),n)}var o}function we(e,t,r){return t&&be(e.prototype,t),r&&be(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}var Me=we((function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.aabb=t,this.entities=null,this.left=null,this.right=null}));function Te(e){return Te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Te(e)}function Ie(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==Te(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==Te(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===Te(o)?o:String(o)),n)}var o}function Se(e,t,r){return t&&Ie(e.prototype,t),r&&Ie(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}var Ae=Se((function e(t,r,n,o,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.metaObjectId=t,this.propertySetIds=r,this.metaObjectType=n,this.metaObjectName=o,this.parentMetaObjectId=i}));function Oe(e){return Oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Oe(e)}function Le(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==Oe(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==Oe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===Oe(o)?o:String(o)),n)}var o}function Pe(e,t,r){return t&&Le(e.prototype,t),r&&Le(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}var Ee=Pe((function e(t,r,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.propertySetId=t,this.propertySetType=r,this.propertySetName=n,this.properties=o}));function je(e){return je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},je(e)}function Ge(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==je(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==je(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===je(o)?o:String(o)),n)}var o}function ke(e,t,r){return t&&Ge(e.prototype,t),r&&Ge(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}var _e=ke((function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.textureId=t.textureId,this.textureIndex=t.textureIndex,this.imageData=t.imageData,this.channel=null,this.width=t.width,this.height=t.height,this.src=t.src,this.compressed=!!t.compressed,this.mediaType=t.mediaType,this.minFilter=t.minFilter||I,this.magFilter=t.magFilter||I,this.wrapS=t.wrapS||d,this.wrapT=t.wrapT||d,this.wrapR=t.wrapR||d}));function De(e){return De="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},De(e)}function Ne(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==De(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==De(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===De(o)?o:String(o)),n)}var o}function Fe(e,t,r){return t&&Ne(e.prototype,t),r&&Ne(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}var Ve=Fe((function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.textureSetId=t.textureSetId,this.textureSetIndex=t.textureSetIndex,this.materialType=t.materialType,this.materialIndex=t.materialIndex,this.numInstances=0,this.colorTexture=t.colorTexture,this.metallicRoughnessTexture=t.metallicRoughnessTexture,this.normalsTexture=t.normalsTexture,this.emissiveTexture=t.emissiveTexture,this.occlusionTexture=t.occlusionTexture}));const Ce=require("@loaders.gl/core"),Be=require("@loaders.gl/textures"),ze=require("@loaders.gl/images");function Ue(e){return Ue="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ue(e)}function Xe(){Xe=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function c(e,t,r,o){var i=t&&t.prototype instanceof f?t:f,a=Object.create(i.prototype),s=new S(o||[]);return n(a,"_invoke",{value:w(e,r,s)}),a}function l(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var h={};function f(){}function d(){}function p(){}var v={};u(v,i,(function(){return this}));var m=Object.getPrototypeOf,y=m&&m(m(A([])));y&&y!==t&&r.call(y,i)&&(v=y);var g=p.prototype=f.prototype=Object.create(v);function x(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){function o(n,i,a,s){var u=l(e[n],e,i);if("throw"!==u.type){var c=u.arg,h=c.value;return h&&"object"==Ue(h)&&r.call(h,"__await")?t.resolve(h.__await).then((function(e){o("next",e,a,s)}),(function(e){o("throw",e,a,s)})):t.resolve(h).then((function(e){c.value=e,a(c)}),(function(e){return o("throw",e,a,s)}))}s(u.arg)}var i;n(this,"_invoke",{value:function(e,r){function n(){return new t((function(t,n){o(e,r,t,n)}))}return i=i?i.then(n,n):n()}})}function w(e,t,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return{value:void 0,done:!0}}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var s=M(a,r);if(s){if(s===h)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=l(e,t,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===h)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}function M(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,M(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),h;var o=l(n,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,h;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,h):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,h)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function I(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function A(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:O}}function O(){return{value:void 0,done:!0}}return d.prototype=p,n(g,"constructor",{value:p,configurable:!0}),n(p,"constructor",{value:d,configurable:!0}),d.displayName=u(p,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===d||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,u(e,s,"GeneratorFunction")),e.prototype=Object.create(g),e},e.awrap=function(e){return{__await:e}},x(b.prototype),u(b.prototype,a,(function(){return this})),e.AsyncIterator=b,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new b(c(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},x(g),u(g,s,"Generator"),u(g,i,(function(){return this})),u(g,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=A,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(I),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,h):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),I(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;I(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:A(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),h}},e}function Re(e,t,r,n,o,i,a){try{var s=e[i](a),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function Ke(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==Ue(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==Ue(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===Ue(o)?o:String(o)),n)}var o}var qe=_.vec4([0,0,0,1]),Ze=_.vec4([0,0,0,1]),Ye=_.mat4(),We=_.mat4(),Qe=new Float64Array(3),Je={0:{useSRGB:!0,qualityLevel:50,encodeUASTC:!0,mipmaps:!0},3:{useSRGB:!0,encodeUASTC:!0,qualityLevel:10,mipmaps:!1},1:{useSRGB:!1,encodeUASTC:!0,qualityLevel:50,mipmaps:!0},2:{useSRGB:!1,encodeUASTC:!0,qualityLevel:10,mipmaps:!1},4:{useSRGB:!1,encodeUASTC:!0,qualityLevel:10,mipmaps:!1}},He=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.modelId=t.modelId||"default",this.projectId=t.projectId||"",this.revisionId=t.revisionId||"",this.author=t.author||"",this.createdAt=t.createdAt||"",this.creatingApplication=t.creatingApplication||"",this.schema=t.schema||"",this.xktVersion=f.xktVersion,this.edgeThreshold=t.edgeThreshold||10,this.minTileSize=t.minTileSize||500,this.propertySets={},this.propertySetsList=[],this.metaObjects={},this.metaObjectsList=[],this.reusedGeometriesDecodeMatrix=new Float32Array(16),this.geometries={},this.geometriesList=[],this.textures={},this.texturesList=[],this.textureSets={},this.textureSetsList=[],this.meshes={},this.meshesList=[],this.entities={},this.entitiesList=[],this.tilesList=[],this.aabb=_.AABB3(),this.finalized=!1}var t,r,n,o;return t=e,r=[{key:"createPropertySet",value:function(e){if(!e)throw"Parameters expected: params";if(null===e.propertySetId||void 0===e.propertySetId)throw"Parameter expected: params.propertySetId";if(null===e.properties||void 0===e.properties)throw"Parameter expected: params.properties";if(this.finalized)console.error("XKTModel has been finalized, can't add more property sets");else if(!this.propertySets[e.propertySetId]){var t=e.propertySetId,r=e.propertySetType||"Default",n=e.propertySetName||e.propertySetId,o=e.properties||[],i=new Ee(t,r,n,o);return this.propertySets[t]=i,this.propertySetsList.push(i),i}}},{key:"createMetaObject",value:function(e){if(!e)throw"Parameters expected: params";if(null===e.metaObjectId||void 0===e.metaObjectId)throw"Parameter expected: params.metaObjectId";if(this.finalized)console.error("XKTModel has been finalized, can't add more meta objects");else if(!this.metaObjects[e.metaObjectId]){var t=e.metaObjectId,r=e.propertySetIds,n=e.metaObjectType||"Default",o=e.metaObjectName||e.metaObjectId,i=e.parentMetaObjectId,a=new Ae(t,r,n,o,i);return this.metaObjects[t]=a,this.metaObjectsList.push(a),i||this._rootMetaObject||(this._rootMetaObject=a),a}}},{key:"createTexture",value:function(e){if(!e)throw"Parameters expected: params";if(null===e.textureId||void 0===e.textureId)throw"Parameter expected: params.textureId";if(!e.imageData&&!e.src)throw"Parameter expected: params.imageData or params.src";if(this.finalized)console.error("XKTModel has been finalized, can't add more textures");else{if(!this.textures[e.textureId]){if(e.src){var t=e.src.split(".").pop();if("jpg"!==t&&"jpeg"!==t&&"png"!==t)return void console.error("XKTModel does not support image files with extension '".concat(t,"' - won't create texture '").concat(e.textureId))}var r=e.textureId,n=new _e({textureId:r,imageData:e.imageData,mediaType:e.mediaType,minFilter:e.minFilter,magFilter:e.magFilter,wrapS:e.wrapS,wrapT:e.wrapT,wrapR:e.wrapR,width:e.width,height:e.height,compressed:!1!==e.compressed,src:e.src});return this.textures[r]=n,this.texturesList.push(n),n}console.error("XKTTexture already exists with this ID: "+e.textureId)}}},{key:"createTextureSet",value:function(e){if(!e)throw"Parameters expected: params";if(null===e.textureSetId||void 0===e.textureSetId)throw"Parameter expected: params.textureSetId";if(this.finalized)console.error("XKTModel has been finalized, can't add more textureSets");else{if(!this.textureSets[e.textureSetId]){var t,r,n,o,i;if(void 0!==e.colorTextureId&&null!==e.colorTextureId){if(!(t=this.textures[e.colorTextureId]))return void console.error("Texture not found: ".concat(e.colorTextureId," - ensure that you create it first with createTexture()"));t.channel=0}if(void 0!==e.metallicRoughnessTextureId&&null!==e.metallicRoughnessTextureId){if(!(r=this.textures[e.metallicRoughnessTextureId]))return void console.error("Texture not found: ".concat(e.metallicRoughnessTextureId," - ensure that you create it first with createTexture()"));r.channel=1}if(void 0!==e.normalsTextureId&&null!==e.normalsTextureId){if(!(n=this.textures[e.normalsTextureId]))return void console.error("Texture not found: ".concat(e.normalsTextureId," - ensure that you create it first with createTexture()"));n.channel=2}if(void 0!==e.emissiveTextureId&&null!==e.emissiveTextureId){if(!(o=this.textures[e.emissiveTextureId]))return void console.error("Texture not found: ".concat(e.emissiveTextureId," - ensure that you create it first with createTexture()"));o.channel=3}if(void 0!==e.occlusionTextureId&&null!==e.occlusionTextureId){if(!(i=this.textures[e.occlusionTextureId]))return void console.error("Texture not found: ".concat(e.occlusionTextureId," - ensure that you create it first with createTexture()"));i.channel=4}var a=new Ve({textureSetId:e.textureSetId,textureSetIndex:this.textureSetsList.length,colorTexture:t,metallicRoughnessTexture:r,normalsTexture:n,emissiveTexture:o,occlusionTexture:i});return this.textureSets[e.textureSetId]=a,this.textureSetsList.push(a),a}console.error("XKTTextureSet already exists with this ID: "+e.textureSetId)}}},{key:"createGeometry",value:function(e){if(!e)throw"Parameters expected: params";if(null===e.geometryId||void 0===e.geometryId)throw"Parameter expected: params.geometryId";if(!e.primitiveType)throw"Parameter expected: params.primitiveType";if(!e.positions)throw"Parameter expected: params.positions";var t="triangles"===e.primitiveType,r="points"===e.primitiveType,n="lines"===e.primitiveType,o="line-strip"===e.primitiveType;if(e.primitiveType,e.primitiveType,!(t||r||n||o))throw"Unsupported value for params.primitiveType: "+e.primitiveType+"' - supported values are 'triangles', 'points', 'lines', 'line-strip', 'triangle-strip' and 'triangle-fan";if(t&&!e.indices)throw"Parameter expected for 'triangles' primitive: params.indices";if(r&&!e.colors&&!e.colorsCompressed)throw"Parameter expected for 'points' primitive: params.colors or params.colorsCompressed";if(n&&!e.indices)throw"Parameter expected for 'lines' primitive: params.indices";if(this.finalized)console.error("XKTModel has been finalized, can't add more geometries");else{if(!this.geometries[e.geometryId]){var i=e.geometryId,a=e.primitiveType,s=new Float64Array(e.positions),u={geometryId:i,geometryIndex:this.geometriesList.length,primitiveType:a,positions:s,uvs:e.uvs||e.uv};if(t&&(e.normals&&(u.normals=new Float32Array(e.normals)),u.indices=e.indices),r)if(e.colorsCompressed)u.colorsCompressed=new Uint8Array(e.colorsCompressed);else{for(var c=e.colors,l=new Uint8Array(c.length),h=0,f=c.length;h<f;h++)l[h]=Math.floor(255*c[h]);u.colorsCompressed=l}if(n&&(u.indices=e.indices),t){if(!e.normals&&!e.uv&&!e.uvs){var d=[],p=[];!function(e,t,r,n){for(var o={},i=[],a=Math.pow(10,4),s=0,u=e.length;s<u;s+=3){var c=e[s],l=e[s+1],h=e[s+2],f="".concat(Math.round(c*a),"_").concat(Math.round(l*a),"_").concat(Math.round(h*a));void 0===o[f]&&(o[f]=r.length/3,r.push(c),r.push(l),r.push(h)),i[s/3]=o[f]}for(var d=0,p=t.length;d<p;d++)n[d]=i[t[d]]}(u.positions,u.indices,d,p),u.positions=new Float64Array(d),u.indices=p}u.edgeIndices=re(u.positions,u.indices,null,e.edgeThreshold||this.edgeThreshold||10)}var v=new le(u);return this.geometries[i]=v,this.geometriesList.push(v),v}console.error("XKTGeometry already exists with this ID: "+e.geometryId)}}},{key:"createMesh",value:function(e){if(null===e.meshId||void 0===e.meshId)throw"Parameter expected: params.meshId";if(null===e.geometryId||void 0===e.geometryId)throw"Parameter expected: params.geometryId";if(this.finalized)throw"XKTModel has been finalized, can't add more meshes";if(this.meshes[e.meshId])console.error("XKTMesh already exists with this ID: "+e.meshId);else{var t=this.geometries[e.geometryId];if(t){t.numInstances++;var r=null;if(e.textureSetId){if(!(r=this.textureSets[e.textureSetId]))return void console.error("XKTTextureSet not found: "+e.textureSetId);r.numInstances++}var n=e.matrix;if(!n){var o=e.position,i=e.scale,a=e.rotation;if(o||i||a){n=_.identityMat4();var s=_.eulerToQuaternion(a||[0,0,0],"XYZ",_.identityQuaternion());_.composeMat4(o||[0,0,0],s,i||[1,1,1],n)}else n=_.identityMat4()}var u=this.meshesList.length,c=new se({meshId:e.meshId,meshIndex:u,matrix:n,geometry:t,color:e.color,metallic:e.metallic,roughness:e.roughness,opacity:e.opacity,textureSet:r});return this.meshes[c.meshId]=c,this.meshesList.push(c),c}console.error("XKTGeometry not found: "+e.geometryId)}}},{key:"createEntity",value:function(e){if(!e)throw"Parameters expected: params";if(null===e.entityId||void 0===e.entityId)throw"Parameter expected: params.entityId";if(!e.meshIds)throw"Parameter expected: params.meshIds";if(this.finalized)console.error("XKTModel has been finalized, can't add more entities");else{if(0!==e.meshIds.length){var t=e.entityId;if(this.entities[t]){for(;this.entities[t];)t=_.createUUID();console.error("XKTEntity already exists with this ID: "+e.entityId+" - substituting random ID instead: "+t)}for(var r=e.meshIds,n=[],o=0,i=r.length;o<i;o++){var a=r[o],s=this.meshes[a];s?s.entity?console.error("XKTMesh "+a+" already used by XKTEntity "+s.entity.entityId):n.push(s):console.error("XKTMesh found: "+a)}for(var u=new pe(t,n),c=0,l=n.length;c<l;c++)n[c].entity=u;return this.entities[t]=u,this.entitiesList.push(u),u}console.warn("XKTEntity has no meshes - won't create: "+e.entityId)}}},{key:"createDefaultMetaObjects",value:function(){for(var e=0,t=this.entitiesList.length;e<t;e++){var r=this.entitiesList[e].entityId;this.metaObjects[r]||(this._rootMetaObject||(this._rootMetaObject=this.createMetaObject({metaObjectId:this.modelId,metaObjectType:"Default",metaObjectName:this.modelId})),this.createMetaObject({metaObjectId:r,metaObjectType:"Default",metaObjectName:""+r,parentMetaObjectId:this._rootMetaObject.metaObjectId}))}}},{key:"finalize",value:(n=Xe().mark((function e(){var t;return Xe().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.finalized){e.next=3;break}return console.log("XKTModel already finalized"),e.abrupt("return");case 3:return this._removeUnusedTextures(),e.next=6,this._compressTextures();case 6:this._bakeSingleUseGeometryPositions(),this._bakeAndOctEncodeNormals(),this._createEntityAABBs(),t=this._createKDTree(),this.entitiesList=[],this._createTilesFromKDTree(t),this._createReusedGeometriesDecodeMatrix(),this._flagSolidGeometries(),this.aabb.set(t.aabb),this.finalized=!0;case 16:case"end":return e.stop()}}),e,this)})),o=function(){var e=this,t=arguments;return new Promise((function(r,o){var i=n.apply(e,t);function a(e){Re(i,r,o,a,s,"next",e)}function s(e){Re(i,r,o,a,s,"throw",e)}a(void 0)}))},function(){return o.apply(this,arguments)})},{key:"_removeUnusedTextures",value:function(){for(var e=[],t={},r=0,n=this.texturesList.length;r<n;r++){var o=this.texturesList[r];null!==o.channel&&(o.textureIndex=e.length,e.push(o),t[o.textureId]=o)}this.texturesList=e,this.textures=t}},{key:"_compressTextures",value:function(){var e=this,t=this.texturesList.length;return new Promise((function(r){if(0!==t)for(var n=function(){var n=e.texturesList[o],i=Je[n.channel]||{};if(n.src){var a=n.src;switch(a.split(".").pop()){case"jpeg":case"jpg":case"png":(0,Ce.load)(a,ze.ImageLoader,{image:{type:"data"}}).then((function(e){n.compressed?(0,Ce.encode)(e,Be.KTX2BasisWriter,i).then((function(e){var o=new Uint8Array(e);n.imageData=o,--t<=0&&r()})).catch((function(e){console.error("[XKTModel.finalize] Failed to encode image: "+e),--t<=0&&r()})):(n.imageData=new Uint8Array(1),--t<=0&&r())})).catch((function(e){console.error("[XKTModel.finalize] Failed to load image: "+e),--t<=0&&r()}));break;default:--t<=0&&r()}}n.imageData&&(n.compressed?(0,Ce.encode)(n.imageData,Be.KTX2BasisWriter,i).then((function(e){n.imageData=new Uint8Array(e),--t<=0&&r()})).catch((function(e){console.error("[XKTModel.finalize] Failed to encode image: "+e),--t<=0&&r()})):(n.imageData=new Uint8Array(1),--t<=0&&r()))},o=0,i=e.texturesList.length;o<i;o++)n();else r()}))}},{key:"_bakeSingleUseGeometryPositions",value:function(){for(var e=0,t=this.meshesList.length;e<t;e++){var r=this.meshesList[e],n=r.geometry;if(1===n.numInstances){var o=r.matrix;if(o&&!_.isIdentityMat4(o))for(var i=n.positions,a=0,s=i.length;a<s;a+=3)qe[0]=i[a+0],qe[1]=i[a+1],qe[2]=i[a+2],qe[3]=1,_.transformPoint4(o,qe,Ze),i[a+0]=Ze[0],i[a+1]=Ze[1],i[a+2]=Ze[2]}}}},{key:"_bakeAndOctEncodeNormals",value:function(){for(var e=0,t=this.meshesList.length;e<t;e++){var r=this.meshesList[e],n=r.geometry;if(n.normals&&!n.normalsOctEncoded)if(n.normalsOctEncoded=new Int8Array(n.normals.length),n.numInstances>1)te.octEncodeNormals(n.normals,n.normals.length,n.normalsOctEncoded,0);else{var o=_.inverseMat4(_.transposeMat4(r.matrix,Ye),We);te.transformAndOctEncodeNormals(o,n.normals,n.normals.length,n.normalsOctEncoded,0)}}}},{key:"_createEntityAABBs",value:function(){for(var e=0,t=this.entitiesList.length;e<t;e++){var r=this.entitiesList[e],n=r.aabb,o=r.meshes;_.collapseAABB3(n);for(var i=0,a=o.length;i<a;i++){var s=o[i],u=s.geometry,c=s.matrix;if(u.numInstances>1)for(var l=u.positions,h=0,f=l.length;h<f;h+=3)qe[0]=l[h+0],qe[1]=l[h+1],qe[2]=l[h+2],qe[3]=1,_.transformPoint4(c,qe,Ze),_.expandAABB3Point3(n,Ze);else for(var d=u.positions,p=0,v=d.length;p<v;p+=3)qe[0]=d[p+0],qe[1]=d[p+1],qe[2]=d[p+2],_.expandAABB3Point3(n,qe)}}}},{key:"_createKDTree",value:function(){for(var e=_.collapseAABB3(),t=0,r=this.entitiesList.length;t<r;t++){var n=this.entitiesList[t];_.expandAABB3(e,n.aabb)}for(var o=new Me(e),i=0,a=this.entitiesList.length;i<a;i++){var s=this.entitiesList[i];this._insertEntityIntoKDTree(o,s)}return o}},{key:"_insertEntityIntoKDTree",value:function(e,t){var r=e.aabb,n=t.aabb;if(_.getAABB3Diag(r)<this.minTileSize)return e.entities=e.entities||[],e.entities.push(t),void _.expandAABB3(r,n);if(e.left&&_.containsAABB3(e.left.aabb,n))this._insertEntityIntoKDTree(e.left,t);else if(e.right&&_.containsAABB3(e.right.aabb,n))this._insertEntityIntoKDTree(e.right,t);else{Qe[0]=r[3]-r[0],Qe[1]=r[4]-r[1],Qe[2]=r[5]-r[2];var o=0;if(Qe[1]>Qe[o]&&(o=1),Qe[2]>Qe[o]&&(o=2),!e.left){var i=r.slice();if(i[o+3]=(r[o]+r[o+3])/2,e.left=new Me(i),_.containsAABB3(i,n))return void this._insertEntityIntoKDTree(e.left,t)}if(!e.right){var a=r.slice();if(a[o]=(r[o]+r[o+3])/2,e.right=new Me(a),_.containsAABB3(a,n))return void this._insertEntityIntoKDTree(e.right,t)}e.entities=e.entities||[],e.entities.push(t),_.expandAABB3(r,n)}}},{key:"_createTilesFromKDTree",value:function(e){this._createTilesFromKDNode(e)}},{key:"_createTilesFromKDNode",value:function(e){e.entities&&e.entities.length>0&&this._createTileFromEntities(e.entities),e.left&&this._createTilesFromKDNode(e.left),e.right&&this._createTilesFromKDNode(e.right)}},{key:"_createTileFromEntities",value:function(e){var t=_.AABB3();_.collapseAABB3(t);for(var r=0;r<e.length;r++){var n=e[r];_.expandAABB3(t,n.aabb)}var o=_.getAABB3Center(t),i=_.mulVec3Scalar(o,-1,_.vec3()),a=_.AABB3();a[0]=t[0]-o[0],a[1]=t[1]-o[1],a[2]=t[2]-o[2],a[3]=t[3]-o[0],a[4]=t[4]-o[1],a[5]=t[5]-o[2];for(var s=0;s<e.length;s++){for(var u=e[s],c=u.meshes,l=0,h=c.length;l<h;l++){var f=c[l],d=f.geometry;if(d.reused)_.translateMat4v(i,f.matrix);else{for(var p=d.positions,v=0,m=p.length;v<m;v+=3)p[v+0]-=o[0],p[v+1]-=o[1],p[v+2]-=o[2];te.quantizePositions(p,p.length,a,d.positionsQuantized)}}u.entityIndex=this.entitiesList.length,this.entitiesList.push(u)}var y=new ge(t,e);this.tilesList.push(y)}},{key:"_createReusedGeometriesDecodeMatrix",value:function(){for(var e=_.vec3(),t=_.collapseAABB3(_.AABB3()),r=0,n=0,o=this.geometriesList.length;n<o;n++){var i=this.geometriesList[n];if(i.reused){for(var a=i.positions,s=0,u=a.length;s<u;s+=3)e[0]=a[s],e[1]=a[s+1],e[2]=a[s+2],_.expandAABB3Point3(t,e);r++}}if(r>0){te.createPositionsDecodeMatrix(t,this.reusedGeometriesDecodeMatrix);for(var c=0,l=this.geometriesList.length;c<l;c++){var h=this.geometriesList[c];h.reused&&te.quantizePositions(h.positions,h.positions.length,t,h.positionsQuantized)}}else _.identityMat4(this.reusedGeometriesDecodeMatrix)}},{key:"_flagSolidGeometries",value:function(){for(var e=0,t=0,r=0,n=this.geometriesList.length;r<n;r++){var o=this.geometriesList[r];"triangles"===o.primitiveType&&(o.positionsQuantized.length>e&&(e=o.positionsQuantized.length),o.indices.length>t&&(t=o.indices.length))}for(var i=new Array(e/3),a=new Array(t),s=0,u=this.geometriesList.length;s<u;s++){var c=this.geometriesList[s];"triangles"===c.primitiveType&&(c.solid=ne(c.indices,c.positionsQuantized,i,a))}}}],r&&Ke(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();const $e=require("pako");var et=f.xktVersion,tt=9,rt=6;function nt(e,t,r,n){var o=function(e,t,r){for(var n=e.propertySetsList,o=e.metaObjectsList,i=e.geometriesList,a=e.texturesList,s=e.textureSetsList,u=e.meshesList,c=e.entitiesList,l=e.tilesList,h=n.length,f=o.length,d=i.length,p=a.length,v=s.length,m=u.length,y=c.length,g=l.length,x=0,b=0,w=0,M=0,T=0,I=0,S=0,A=0,O=0;O<d;O++){var L=i[O];L.positionsQuantized&&(x+=L.positionsQuantized.length),L.normalsOctEncoded&&(b+=L.normalsOctEncoded.length),L.colorsCompressed&&(w+=L.colorsCompressed.length),L.uvs&&(M+=L.uvs.length),L.indices&&(T+=L.indices.length),L.edgeIndices&&(I+=L.edgeIndices.length)}for(var P=0;P<p;P++){var E=a[P];A+=E.imageData.byteLength,E.compressed&&r.numCompressedTextures++}for(var j=0;j<m;j++)u[j].geometry.numInstances>1&&(S+=16);var G={metadata:{},textureData:new Uint8Array(A),eachTextureDataPortion:new Uint32Array(p),eachTextureAttributes:new Uint16Array(p*tt),positions:new Uint16Array(x),normals:new Int8Array(b),colors:new Uint8Array(w),uvs:new Float32Array(M),indices:new Uint32Array(T),edgeIndices:new Uint32Array(I),eachTextureSetTextures:new Int32Array(5*v),matrices:new Float32Array(S),reusedGeometriesDecodeMatrix:new Float32Array(e.reusedGeometriesDecodeMatrix),eachGeometryPrimitiveType:new Uint8Array(d),eachGeometryPositionsPortion:new Uint32Array(d),eachGeometryNormalsPortion:new Uint32Array(d),eachGeometryColorsPortion:new Uint32Array(d),eachGeometryUVsPortion:new Uint32Array(d),eachGeometryIndicesPortion:new Uint32Array(d),eachGeometryEdgeIndicesPortion:new Uint32Array(d),eachMeshGeometriesPortion:new Uint32Array(m),eachMeshMatricesPortion:new Uint32Array(m),eachMeshTextureSet:new Int32Array(m),eachMeshMaterialAttributes:new Uint8Array(m*rt),eachEntityId:[],eachEntityMeshesPortion:new Uint32Array(y),eachTileAABB:new Float64Array(6*g),eachTileEntitiesPortion:new Uint32Array(g)},k=0,_=0,D=0,N=0,F=0,V=0;G.metadata={id:e.modelId,projectId:e.projectId,revisionId:e.revisionId,author:e.author,createdAt:e.createdAt,creatingApplication:e.creatingApplication,schema:e.schema,propertySets:[],metaObjects:[]};for(var C=0;C<h;C++){var B=n[C],z={id:""+B.propertySetId,name:B.propertySetName,type:B.propertySetType,properties:B.properties};G.metadata.propertySets.push(z)}if(!t)for(var U=0;U<f;U++){var X=o[U],R={name:X.metaObjectName,type:X.metaObjectType,id:""+X.metaObjectId};void 0!==X.parentMetaObjectId&&null!==X.parentMetaObjectId&&(R.parent=""+X.parentMetaObjectId),X.propertySetIds&&X.propertySetIds.length>0&&(R.propertySetIds=X.propertySetIds),X.external&&(R.external=X.external),G.metadata.metaObjects.push(R)}for(var K=0;K<d;K++){var q=i[K],Z=1;switch(q.primitiveType){case"triangles":Z=q.solid?0:1;break;case"points":Z=2;break;case"lines":Z=3;break;case"line-strip":Z=4;break;case"triangle-strip":Z=5;break;case"triangle-fan":Z=6;break;default:Z=1}G.eachGeometryPrimitiveType[K]=Z,G.eachGeometryPositionsPortion[K]=k,G.eachGeometryNormalsPortion[K]=_,G.eachGeometryColorsPortion[K]=D,G.eachGeometryUVsPortion[K]=N,G.eachGeometryIndicesPortion[K]=F,G.eachGeometryEdgeIndicesPortion[K]=V,q.positionsQuantized&&(G.positions.set(q.positionsQuantized,k),k+=q.positionsQuantized.length),q.normalsOctEncoded&&(G.normals.set(q.normalsOctEncoded,_),_+=q.normalsOctEncoded.length),q.colorsCompressed&&(G.colors.set(q.colorsCompressed,D),D+=q.colorsCompressed.length),q.uvs&&(G.uvs.set(q.uvs,N),N+=q.uvs.length),q.indices&&(G.indices.set(q.indices,F),F+=q.indices.length),q.edgeIndices&&(G.edgeIndices.set(q.edgeIndices,V),V+=q.edgeIndices.length)}for(var Y=0,W=e.texturesList.length,Q=0;Y<W;Y++){var J=e.texturesList[Y],H=J.imageData;G.textureData.set(H,Q),G.eachTextureDataPortion[Y]=Q,Q+=H.byteLength;var $=Y*tt;G.eachTextureAttributes[$++]=J.compressed?1:0,G.eachTextureAttributes[$++]=J.mediaType,G.eachTextureAttributes[$++]=J.width,G.eachTextureAttributes[$++]=J.height,G.eachTextureAttributes[$++]=J.minFilter,G.eachTextureAttributes[$++]=J.magFilter,G.eachTextureAttributes[$++]=J.wrapS,G.eachTextureAttributes[$++]=J.wrapT,G.eachTextureAttributes[$++]=J.wrapR}for(var ee=0,te=e.textureSetsList.length,re=0;ee<te;ee++){var ne=s[ee];G.eachTextureSetTextures[re++]=ne.colorTexture?ne.colorTexture.textureIndex:-1,G.eachTextureSetTextures[re++]=ne.metallicRoughnessTexture?ne.metallicRoughnessTexture.textureIndex:-1,G.eachTextureSetTextures[re++]=ne.normalsTexture?ne.normalsTexture.textureIndex:-1,G.eachTextureSetTextures[re++]=ne.emissiveTexture?ne.emissiveTexture.textureIndex:-1,G.eachTextureSetTextures[re++]=ne.occlusionTexture?ne.occlusionTexture.textureIndex:-1}for(var oe=0,ie=0,ae=0,se=0,ue=0,ce=0;ce<g;ce++){var le=l[ce],he=le.entities,fe=he.length;if(0!==fe){G.eachTileEntitiesPortion[ce]=oe;for(var de=le.aabb,pe=0;pe<fe;pe++){for(var ve=he[pe],me=ve.meshes,ye=me.length,ge=0;ge<ye;ge++){var xe=me[ge],be=xe.geometry.geometryIndex;G.eachMeshGeometriesPortion[ie+ge]=be,xe.geometry.numInstances>1&&(G.matrices.set(xe.matrix,se),G.eachMeshMatricesPortion[ue]=se,se+=16),G.eachMeshTextureSet[ue]=xe.textureSet?xe.textureSet.textureSetIndex:-1,G.eachMeshMaterialAttributes[ae++]=255*xe.color[0],G.eachMeshMaterialAttributes[ae++]=255*xe.color[1],G.eachMeshMaterialAttributes[ae++]=255*xe.color[2],G.eachMeshMaterialAttributes[ae++]=255*xe.opacity,G.eachMeshMaterialAttributes[ae++]=255*xe.metallic,G.eachMeshMaterialAttributes[ae++]=255*xe.roughness,ue++}G.eachEntityId[oe]=ve.entityId,G.eachEntityMeshesPortion[oe]=ie,oe++,ie+=ye}var we=6*ce;G.eachTileAABB.set(de,we)}}return G}(e,t,r),i=function(e,t,r){function n(e){return!1!==r.zip?$e.deflate(e):e}return{metadata:n(ot(t||e.metadata)),textureData:n(e.textureData.buffer),eachTextureDataPortion:n(e.eachTextureDataPortion.buffer),eachTextureAttributes:n(e.eachTextureAttributes.buffer),positions:n(e.positions.buffer),normals:n(e.normals.buffer),colors:n(e.colors.buffer),uvs:n(e.uvs.buffer),indices:n(e.indices.buffer),edgeIndices:n(e.edgeIndices.buffer),eachTextureSetTextures:n(e.eachTextureSetTextures.buffer),matrices:n(e.matrices.buffer),reusedGeometriesDecodeMatrix:n(e.reusedGeometriesDecodeMatrix.buffer),eachGeometryPrimitiveType:n(e.eachGeometryPrimitiveType.buffer),eachGeometryPositionsPortion:n(e.eachGeometryPositionsPortion.buffer),eachGeometryNormalsPortion:n(e.eachGeometryNormalsPortion.buffer),eachGeometryColorsPortion:n(e.eachGeometryColorsPortion.buffer),eachGeometryUVsPortion:n(e.eachGeometryUVsPortion.buffer),eachGeometryIndicesPortion:n(e.eachGeometryIndicesPortion.buffer),eachGeometryEdgeIndicesPortion:n(e.eachGeometryEdgeIndicesPortion.buffer),eachMeshGeometriesPortion:n(e.eachMeshGeometriesPortion.buffer),eachMeshMatricesPortion:n(e.eachMeshMatricesPortion.buffer),eachMeshTextureSet:n(e.eachMeshTextureSet.buffer),eachMeshMaterialAttributes:n(e.eachMeshMaterialAttributes.buffer),eachEntityId:n(JSON.stringify(e.eachEntityId).replace(/[\u007F-\uFFFF]/g,(function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).substr(-4)}))),eachEntityMeshesPortion:n(e.eachEntityMeshesPortion.buffer),eachTileAABB:n(e.eachTileAABB.buffer),eachTileEntitiesPortion:n(e.eachTileEntitiesPortion.buffer)}}(o,t,n);r.texturesSize+=i.textureData.byteLength;var a=function(e){return function(e){var t=new Uint32Array(e.length+2);t[0]=et,t[1]=e.length;for(var r=0,n=0,o=e.length;n<o;n++){var i=e[n].length;t[n+2]=i,r+=i}var a=new Uint8Array(t.buffer),s=new Uint8Array(a.length+r);s.set(a);for(var u=a.length,c=0,l=e.length;c<l;c++){var h=e[c];s.set(h,u),u+=h.length}return s.buffer}([e.metadata,e.textureData,e.eachTextureDataPortion,e.eachTextureAttributes,e.positions,e.normals,e.colors,e.uvs,e.indices,e.edgeIndices,e.eachTextureSetTextures,e.matrices,e.reusedGeometriesDecodeMatrix,e.eachGeometryPrimitiveType,e.eachGeometryPositionsPortion,e.eachGeometryNormalsPortion,e.eachGeometryColorsPortion,e.eachGeometryUVsPortion,e.eachGeometryIndicesPortion,e.eachGeometryEdgeIndicesPortion,e.eachMeshGeometriesPortion,e.eachMeshMatricesPortion,e.eachMeshTextureSet,e.eachMeshMaterialAttributes,e.eachEntityId,e.eachEntityMeshesPortion,e.eachTileAABB,e.eachTileEntitiesPortion])}(i);return a}function ot(e){return JSON.stringify(e).replace(/[\u007F-\uFFFF]/g,(function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).substr(-4)}))}function it(e,t,r){r=r||2;var n,o,i,a,s,u,c,l=t&&t.length,h=l?t[0]*r:e.length,f=at(e,0,h,r,!0),d=[];if(!f||f.next===f.prev)return d;if(l&&(f=function(e,t,r,n){var o,i,a,s=[];for(o=0,i=t.length;o<i;o++)(a=at(e,t[o]*n,o<i-1?t[o+1]*n:e.length,n,!1))===a.next&&(a.steiner=!0),s.push(yt(a));for(s.sort(dt),o=0;o<s.length;o++)pt(s[o],r),r=st(r,r.next);return r}(e,t,f,r)),e.length>80*r){n=i=e[0],o=a=e[1];for(var p=r;p<h;p+=r)(s=e[p])<n&&(n=s),(u=e[p+1])<o&&(o=u),s>i&&(i=s),u>a&&(a=u);c=0!==(c=Math.max(i-n,a-o))?1/c:0}return ut(f,d,r,n,o,c),d}function at(e,t,r,n,o){var i,a;if(o===Et(e,t,r,n)>0)for(i=t;i<r;i+=n)a=Ot(i,e[i],e[i+1],a);else for(i=r-n;i>=t;i-=n)a=Ot(i,e[i],e[i+1],a);return a&&wt(a,a.next)&&(Lt(a),a=a.next),a}function st(e,t){if(!e)return e;t||(t=e);var r,n=e;do{if(r=!1,n.steiner||!wt(n,n.next)&&0!==bt(n.prev,n,n.next))n=n.next;else{if(Lt(n),(n=t=n.prev)===n.next)break;r=!0}}while(r||n!==t);return t}function ut(e,t,r,n,o,i,a){if(e){!a&&i&&function(e,t,r,n){var o=e;do{null===o.z&&(o.z=mt(o.x,o.y,t,r,n)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next}while(o!==e);o.prevZ.nextZ=null,o.prevZ=null,function(e){var t,r,n,o,i,a,s,u,c=1;do{for(r=e,e=null,i=null,a=0;r;){for(a++,n=r,s=0,t=0;t<c&&(s++,n=n.nextZ);t++);for(u=c;s>0||u>0&&n;)0!==s&&(0===u||!n||r.z<=n.z)?(o=r,r=r.nextZ,s--):(o=n,n=n.nextZ,u--),i?i.nextZ=o:e=o,o.prevZ=i,i=o;r=n}i.nextZ=null,c*=2}while(a>1)}(o)}(e,n,o,i);for(var s,u,c=e;e.prev!==e.next;)if(s=e.prev,u=e.next,i?lt(e,n,o,i):ct(e))t.push(s.i/r),t.push(e.i/r),t.push(u.i/r),Lt(e),e=u.next,c=u.next;else if((e=u)===c){a?1===a?ut(e=ht(st(e),t,r),t,r,n,o,i,2):2===a&&ft(e,t,r,n,o,i):ut(st(e),t,r,n,o,i,1);break}}}function ct(e){var t=e.prev,r=e,n=e.next;if(bt(t,r,n)>=0)return!1;for(var o=e.next.next;o!==e.prev;){if(gt(t.x,t.y,r.x,r.y,n.x,n.y,o.x,o.y)&&bt(o.prev,o,o.next)>=0)return!1;o=o.next}return!0}function lt(e,t,r,n){var o=e.prev,i=e,a=e.next;if(bt(o,i,a)>=0)return!1;for(var s=o.x<i.x?o.x<a.x?o.x:a.x:i.x<a.x?i.x:a.x,u=o.y<i.y?o.y<a.y?o.y:a.y:i.y<a.y?i.y:a.y,c=o.x>i.x?o.x>a.x?o.x:a.x:i.x>a.x?i.x:a.x,l=o.y>i.y?o.y>a.y?o.y:a.y:i.y>a.y?i.y:a.y,h=mt(s,u,t,r,n),f=mt(c,l,t,r,n),d=e.prevZ,p=e.nextZ;d&&d.z>=h&&p&&p.z<=f;){if(d!==e.prev&&d!==e.next&&gt(o.x,o.y,i.x,i.y,a.x,a.y,d.x,d.y)&&bt(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,p!==e.prev&&p!==e.next&&gt(o.x,o.y,i.x,i.y,a.x,a.y,p.x,p.y)&&bt(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;d&&d.z>=h;){if(d!==e.prev&&d!==e.next&&gt(o.x,o.y,i.x,i.y,a.x,a.y,d.x,d.y)&&bt(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;p&&p.z<=f;){if(p!==e.prev&&p!==e.next&&gt(o.x,o.y,i.x,i.y,a.x,a.y,p.x,p.y)&&bt(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function ht(e,t,r){var n=e;do{var o=n.prev,i=n.next.next;!wt(o,i)&&Mt(o,n,n.next,i)&&St(o,i)&&St(i,o)&&(t.push(o.i/r),t.push(n.i/r),t.push(i.i/r),Lt(n),Lt(n.next),n=e=i),n=n.next}while(n!==e);return st(n)}function ft(e,t,r,n,o,i){var a=e;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&xt(a,s)){var u=At(a,s);return a=st(a,a.next),u=st(u,u.next),ut(a,t,r,n,o,i),void ut(u,t,r,n,o,i)}s=s.next}a=a.next}while(a!==e)}function dt(e,t){return e.x-t.x}function pt(e,t){if(t=function(e,t){var r,n=t,o=e.x,i=e.y,a=-1/0;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){var s=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=o&&s>a){if(a=s,s===o){if(i===n.y)return n;if(i===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!r)return null;if(o===a)return r;var u,c=r,l=r.x,h=r.y,f=1/0;n=r;do{o>=n.x&&n.x>=l&&o!==n.x&&gt(i<h?o:a,i,l,h,i<h?a:o,i,n.x,n.y)&&(u=Math.abs(i-n.y)/(o-n.x),St(n,e)&&(u<f||u===f&&(n.x>r.x||n.x===r.x&&vt(r,n)))&&(r=n,f=u)),n=n.next}while(n!==c);return r}(e,t),t){var r=At(t,e);st(t,t.next),st(r,r.next)}}function vt(e,t){return bt(e.prev,e,t.prev)<0&&bt(t.next,e,e.next)<0}function mt(e,t,r,n,o){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*o)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*o)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function yt(e){var t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function gt(e,t,r,n,o,i,a,s){return(o-a)*(t-s)-(e-a)*(i-s)>=0&&(e-a)*(n-s)-(r-a)*(t-s)>=0&&(r-a)*(i-s)-(o-a)*(n-s)>=0}function xt(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&Mt(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&(St(e,t)&&St(t,e)&&function(e,t){var r=e,n=!1,o=(e.x+t.x)/2,i=(e.y+t.y)/2;do{r.y>i!=r.next.y>i&&r.next.y!==r.y&&o<(r.next.x-r.x)*(i-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==e);return n}(e,t)&&(bt(e.prev,e,t.prev)||bt(e,t.prev,t))||wt(e,t)&&bt(e.prev,e,e.next)>0&&bt(t.prev,t,t.next)>0)}function bt(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function wt(e,t){return e.x===t.x&&e.y===t.y}function Mt(e,t,r,n){var o=It(bt(e,t,r)),i=It(bt(e,t,n)),a=It(bt(r,n,e)),s=It(bt(r,n,t));return o!==i&&a!==s||!(0!==o||!Tt(e,r,t))||!(0!==i||!Tt(e,n,t))||!(0!==a||!Tt(r,e,n))||!(0!==s||!Tt(r,t,n))}function Tt(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function It(e){return e>0?1:e<0?-1:0}function St(e,t){return bt(e.prev,e,e.next)<0?bt(e,t,e.next)>=0&&bt(e,e.prev,t)>=0:bt(e,t,e.prev)<0||bt(e,e.next,t)<0}function At(e,t){var r=new Pt(e.i,e.x,e.y),n=new Pt(t.i,t.x,t.y),o=e.next,i=t.prev;return e.next=t,t.prev=e,r.next=o,o.prev=r,n.next=r,r.prev=n,i.next=n,n.prev=i,n}function Ot(e,t,r,n){var o=new Pt(e,t,r);return n?(o.next=n.next,o.prev=n,n.next.prev=o,n.next=o):(o.prev=o,o.next=o),o}function Lt(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Pt(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Et(e,t,r,n){for(var o=0,i=t,a=r-n;i<r;i+=n)o+=(e[a]-e[i])*(e[i+1]+e[a+1]),a=i;return o}function jt(e){return function(e){if(Array.isArray(e))return Gt(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return Gt(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Gt(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Gt(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}it.deviation=function(e,t,r,n){var o=t&&t.length,i=o?t[0]*r:e.length,a=Math.abs(Et(e,0,i,r));if(o)for(var s=0,u=t.length;s<u;s++){var c=t[s]*r,l=s<u-1?t[s+1]*r:e.length;a-=Math.abs(Et(e,c,l,r))}var h=0;for(s=0;s<n.length;s+=3){var f=n[s]*r,d=n[s+1]*r,p=n[s+2]*r;h+=Math.abs((e[f]-e[p])*(e[d+1]-e[f+1])-(e[f]-e[d])*(e[p+1]-e[f+1]))}return 0===a&&0===h?0:Math.abs((h-a)/a)},it.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},n=0,o=0;o<e.length;o++){for(var i=0;i<e[o].length;i++)for(var a=0;a<t;a++)r.vertices.push(e[o][i][a]);o>0&&(n+=e[o-1].length,r.holes.push(n))}return r};var kt=_.vec2(),_t=_.vec3(),Dt=_.vec3(),Nt=_.vec3();function Ft(e){var t=e.data,r=e.xktModel,n=e.center,o=void 0!==n&&n,i=e.transform,a=void 0===i?null:i,s=e.stats,u=void 0===s?{}:s,c=e.log;return new Promise((function(e,n){if(t)if("CityJSON"===t.type)if(r){var i;c("Using parser: parseCityJSONIntoXKTModel"),c("center: ".concat(o)),a&&c("transform: [".concat(a,"]")),t.transform||o||a?(i=function(e){for(var t=[],r=0,n=0;r<e.length;r++,n+=3){var o=e[r][0],i=e[r][1],a=e[r][2];t.push([o,i,a])}return t}(t.vertices),t.transform&&function(e,t){for(var r=t.scale||_.vec3([1,1,1]),n=t.translate||_.vec3([0,0,0]),o=0;o<e.length;o++){var i=e[o];i[0]=i[0]*r[0]+n[0],i[1]=i[1]*r[1]+n[1],i[2]=i[2]*r[2]+n[2]}}(i,t.transform),o&&Vt(i),a&&function(e,t){if(t)for(var r=_.mat4(t),n=0,o=e.length;n<o;n++){var i=e[n];_.transformPoint3(r,i,i)}}(i,a)):i=t.vertices,u.sourceFormat=t.type||"",u.schemaVersion=t.version||"",u.title="",u.author="",u.created="",u.numMetaObjects=0,u.numPropertySets=0,u.numTriangles=0,u.numVertices=0,u.numObjects=0,u.numGeometries=0;var s=_.createUUID();r.createMetaObject({metaObjectId:s,metaObjectType:"Model",metaObjectName:"Model"}),u.numMetaObjects++;var l=_.createUUID();r.createMetaObject({metaObjectId:l,metaObjectType:"CityJSON",metaObjectName:"CityJSON",parentMetaObjectId:s}),u.numMetaObjects++;var h={data:t,vertices:i,xktModel:r,rootMetaObjectId:l,log:c||function(e){},nextId:0,stats:u};h.xktModel.schema=t.type+" "+t.version,h.log("Converting "+h.xktModel.schema),function(e){var t=e.data.CityObjects;for(var r in t)t.hasOwnProperty(r)&&Ct(e,t[r],r)}(h),e()}else n("Argument expected: xktModel");else n("Invalid argument: data is not a CityJSON file");else n("Argument expected: data")}))}function Vt(e){if(center){for(var t=_.vec3(),r=e.length,n=0,o=e.length;n<o;n++){var i=e[n];t[0]+=i[0],t[1]+=i[1],t[2]+=i[2]}t[0]/=r,t[1]/=r,t[2]/=r;for(var a=0,s=e.length;a<s;a++){var u=e[a];u[0]-=t[0],u[1]-=t[1],u[2]-=t[2]}}}function Ct(e,t,r){var n=e.xktModel,o=e.data,i=r,a=t.type,s=a+" : "+r,u=t.parents?t.parents[0]:e.rootMetaObjectId;if(n.createMetaObject({metaObjectId:i,metaObjectName:s,metaObjectType:a,parentMetaObjectId:u}),e.stats.numMetaObjects++,t.geometry&&t.geometry.length>0){for(var c=[],l=0,h=t.geometry.length;l<h;l++){var f=t.geometry[l],d=void 0,p=void 0,v=o.appearance;if(v){var m=v.materials;if(m){var y=f.material;if(y){var g=Object.keys(y);if(g.length>0){var x=y[g[0]];if(void 0!==x.value)d=m[x.value];else{var b=x.values;if(b){p=[];for(var w=0,M=b.length;w<M;w++){var T=m[b[l]];p.push(T)}}}}}}}p?Bt(e,f,p,c):Ut(e,f,d,c)}c.length>0&&(n.createEntity({entityId:r,meshIds:c}),e.stats.numObjects++)}}function Bt(e,t,r,n){switch(t.type){case"MultiPoint":case"MultiLineString":case"GeometryInstance":break;case"MultiSurface":case"CompositeSurface":zt(e,r,t.boundaries,n);break;case"Solid":for(var o=t.boundaries,i=0;i<o.length;i++)zt(e,r,o[i],n);break;case"MultiSolid":case"CompositeSolid":for(var a=t.boundaries,s=0;s<a.length;s++)for(var u=0;u<a[s].length;u++)zt(e,r,a[s][u],n)}}function zt(e,t,r,n){for(var o=e.vertices,i=e.xktModel,a=0;a<r.length;a++){for(var s=r[a],u=t[a]||{diffuseColor:[.8,.8,.8],transparency:1},c=[],l=[],h=[],f={positions:[],indices:[]},d=0;d<s.length;d++){c.length>0&&l.push(c.length);var p=Rt(e,s[d],h,f);c.push.apply(c,jt(p))}if(3===c.length)f.indices.push(c[0]),f.indices.push(c[1]),f.indices.push(c[2]);else if(c.length>3){for(var v=[],m=0;m<c.length;m++)v.push({x:o[h[c[m]]][0],y:o[h[c[m]]][1],z:o[h[c[m]]][2]});for(var y=Kt(v,_.vec3()),g=[],x=0;x<v.length;x++)qt(v[x],y,kt),g.unshift(kt[0]),g.unshift(kt[1]);for(var b=it(g,l,2),w=0;w<b.length;w+=3)f.indices.unshift(c[b[w]]),f.indices.unshift(c[b[w+1]]),f.indices.unshift(c[b[w+2]])}var M=""+e.nextId++,T=""+e.nextId++;i.createGeometry({geometryId:M,primitiveType:"triangles",positions:f.positions,indices:f.indices}),i.createMesh({meshId:T,geometryId:M,color:u&&u.diffuseColor?u.diffuseColor:[.8,.8,.8],opacity:1}),n.push(T),e.stats.numGeometries++,e.stats.numVertices+=f.positions.length/3,e.stats.numTriangles+=f.indices.length/3}}function Ut(e,t,r,n){var o=e.xktModel,i=[],a={positions:[],indices:[]};switch(t.type){case"MultiPoint":case"MultiLineString":case"GeometryInstance":break;case"MultiSurface":case"CompositeSurface":Xt(e,t.boundaries,i,a);break;case"Solid":for(var s=t.boundaries,u=0;u<s.length;u++)Xt(e,s[u],i,a);break;case"MultiSolid":case"CompositeSolid":for(var c=t.boundaries,l=0;l<c.length;l++)for(var h=0;h<c[l].length;h++)Xt(e,c[l][h],i,a)}var f=""+e.nextId++,d=""+e.nextId++;o.createGeometry({geometryId:f,primitiveType:"triangles",positions:a.positions,indices:a.indices}),o.createMesh({meshId:d,geometryId:f,color:r&&r.diffuseColor?r.diffuseColor:[.8,.8,.8],opacity:1}),n.push(d),e.stats.numGeometries++,e.stats.numVertices+=a.positions.length/3,e.stats.numTriangles+=a.indices.length/3}function Xt(e,t,r,n){for(var o=e.vertices,i=0;i<t.length;i++){for(var a=[],s=[],u=0;u<t[i].length;u++){a.length>0&&s.push(a.length);var c=Rt(e,t[i][u],r,n);a.push.apply(a,jt(c))}if(3===a.length)n.indices.push(a[0]),n.indices.push(a[1]),n.indices.push(a[2]);else if(a.length>3){for(var l=[],h=0;h<a.length;h++)l.push({x:o[r[a[h]]][0],y:o[r[a[h]]][1],z:o[r[a[h]]][2]});for(var f=Kt(l,_.vec3()),d=[],p=0;p<l.length;p++)qt(l[p],f,kt),d.unshift(kt[0]),d.unshift(kt[1]);for(var v=it(d,s,2),m=0;m<v.length;m+=3)n.indices.unshift(a[v[m]]),n.indices.unshift(a[v[m+1]]),n.indices.unshift(a[v[m+2]])}}}function Rt(e,t,r,n){for(var o=e.vertices,i=[],a=0,s=t.length;a<s;a++){var u=t[a];if(r.includes(u)){var c=r.indexOf(u);i.push(c)}else n.positions.push(o[u][0]),n.positions.push(o[u][1]),n.positions.push(o[u][2]),i.push(r.length),r.push(u)}return i}function Kt(e,t){for(var r=0;r<e.length;r++){var n=r+1;n===e.length&&(n=0),t[0]+=(e[r].y-e[n].y)*(e[r].z+e[n].z),t[1]+=(e[r].z-e[n].z)*(e[r].x+e[n].x),t[2]+=(e[r].x-e[n].x)*(e[r].y+e[n].y)}return _.normalizeVec3(t)}function qt(e,t,r){var n=_t,o=Dt,i=Nt;n[0]=e.x,n[1]=e.y,n[2]=e.z,o[0]=t.x,o[1]=t.y,o[2]=t.z,i[0]=1.1,i[1]=1.1,i[2]=1.1,_.lenVec3(_.subVec3(i,o))<.01&&(i[0]+=1,i[1]+=2,i[2]+=3);var a=_.dotVec3(i,o),s=_.mulVec3Scalar(o,a,_.vec3());i[0]-=s[0],i[1]-=s[1],i[2]-=s[2],_.normalizeVec3(i);var u=_.cross3Vec3(o,i,_.vec3()),c=_.dotVec3(n,i),l=_.dotVec3(n,u);r[0]=c,r[1]=l}var Zt={isString:function(e){return"string"==typeof e||e instanceof String},apply:function(e,t){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}};const Yt=require("@loaders.gl/gltf");function Wt(e){var t=e.data,r=e.baseUri,n=e.xktModel,o=e.metaModelData,i=e.includeTextures,a=void 0===i||i,s=e.includeNormals,u=void 0===s||s,c=e.getAttachment,l=e.stats,h=void 0===l?{}:l,f=e.log;return new Promise((function(e,i){t?n?(h.sourceFormat="glTF",h.schemaVersion="2.0",h.title="",h.author="",h.created="",h.numTriangles=0,h.numVertices=0,h.numNormals=0,h.numUVs=0,h.numTextures=0,h.numObjects=0,h.numGeometries=0,(0,Ce.parse)(t,Yt.GLTFLoader,{baseUri:r}).then((function(t){var r={gltfData:t,metaModelCorrections:o?Qt(o):null,getAttachment:c||function(){throw new Error("You must define getAttachment() method to convert glTF with external resources")},log:f||function(e){},error:function(e){console.error(e)},xktModel:n,includeNormals:!1!==u,includeTextures:!1!==a,geometryCreated:{},nextId:0,stats:h};r.log("Using parser: parseGLTFIntoXKTModel"),r.log("Parsing normals: ".concat(r.includeNormals?"enabled":"disabled")),r.log("Parsing textures: ".concat(r.includeTextures?"enabled":"disabled")),r.includeTextures&&function(e){var t=e.gltfData.textures;if(t)for(var r=0,n=t.length;r<n;r++)Jt(e,t[r]),e.stats.numTextures++}(r),function(e){var t=e.gltfData.materials;if(t)for(var r=0,n=t.length;r<n;r++){var o=t[r];o._textureSetId=e.includeTextures?Ht(e,o):null,o._attributes=$t(0,o)}}(r),function(e){var t=e.gltfData,r=t.scene||t.scenes[0];r?function(e,t){var r=t.nodes;if(r){for(var n=0,o=r.length;n<o;n++)er(e,r[n]);for(var i=0,a=r.length;i<a;i++)rr(e,r[i],0,null)}}(e,r):e.error("glTF has no default scene")}(r),e()}),(function(e){i("[parseGLTFIntoXKTModel] ".concat(e))}))):i("Argument expected: xktModel"):i("Argument expected: data")}))}function Qt(e){for(var t={},r={},n=e.metaObjects||[],o={},i=0,a=n.length;i<a;i++){var s=n[i];o[s.id]=s}for(var u=0,c=n.length;u<c;u++){var l=n[u];if(void 0!==l.parent&&null!==l.parent){var h=o[l.parent];if(l.type===h.type){for(var f=h;f.parent&&o[f.parent].type===f.type;)f=o[f.parent];(t[f.id]||(t[f.id]={numChildren:0,countChildren:0})).numChildren++,r[l.id]=f}}}return{metaObjectsMap:o,eachRootStats:t,eachChildRoot:r}}function Jt(e,t){if(t.source&&t.source.image){var r="texture-".concat(e.nextId++),n=w;switch(t.sampler.minFilter){case 9728:n=y;break;case 9729:n=M;break;case 9984:n=g;break;case 9985:n=I;break;case 9986:n=w;break;case 9987:n=A}var o=M;switch(t.sampler.magFilter){case 9728:o=y;break;case 9729:o=M}var i=d;switch(t.sampler.wrapS){case 33071:i=p;break;case 33648:i=m;break;case 10497:i=d}var a=d;switch(t.sampler.wrapT){case 33071:a=p;break;case 33648:a=m;break;case 10497:a=d}var s=d;switch(t.sampler.wrapR){case 33071:s=p;break;case 33648:s=m;break;case 10497:s=d}e.xktModel.createTexture({textureId:r,imageData:t.source.image,mediaType:t.source.mediaType,compressed:!0,width:t.source.image.width,height:t.source.image.height,minFilter:n,magFilter:o,wrapS:i,wrapT:a,wrapR:s,flipY:!!t.flipY}),t._textureId=r}}function Ht(e,t){var r={};t.normalTexture&&(r.normalTextureId=t.normalTexture.texture._textureId),t.occlusionTexture&&(r.occlusionTextureId=t.occlusionTexture.texture._textureId),t.emissiveTexture&&(r.emissiveTextureId=t.emissiveTexture.texture._textureId);var n=t.pbrMetallicRoughness;if(t.pbrMetallicRoughness){var o=t.pbrMetallicRoughness,i=o.baseColorTexture||o.colorTexture;i&&(i.texture?r.colorTextureId=i.texture._textureId:r.colorTextureId=e.gltfData.textures[i.index]._textureId),n.metallicRoughnessTexture&&(r.metallicRoughnessTextureId=n.metallicRoughnessTexture.texture._textureId)}var a=t.extensions;if(a){var s=a.KHR_materials_pbrSpecularGlossiness;if(s){s.specularTexture;var u=s.specularColorTexture;null!=u&&(r.colorTextureId=e.gltfData.textures[u.index]._textureId)}}return void 0!==r.normalTextureId||void 0!==r.occlusionTextureId||void 0!==r.emissiveTextureId||void 0!==r.colorTextureId||void 0!==r.metallicRoughnessTextureId?(r.textureSetId="textureSet-".concat(e.nextId++,";"),e.xktModel.createTextureSet(r),e.stats.numTextureSets++,r.textureSetId):null}function $t(e,t){var r=t.extensions,n={color:new Float32Array([1,1,1,1]),opacity:1,metallic:0,roughness:1};if(r){var o=r.KHR_materials_pbrSpecularGlossiness;if(o){var i=o.diffuseFactor;null!=i&&n.color.set(i)}var a=r.KHR_materials_common;if(a){var s=a.technique,u=a.values||{},c="BLINN"===s,l="PHONG"===s,h="LAMBERT"===s,f=u.diffuse;f&&(c||l||h)&&(Zt.isString(f)||n.color.set(f));var d=u.transparency;null!=d&&(n.opacity=d);var p=u.transparent;null!=p&&(n.opacity=p)}}var v=t.pbrMetallicRoughness;if(v){var m=v.baseColorFactor;m&&(n.color[0]=m[0],n.color[1]=m[1],n.color[2]=m[2],n.opacity=m[3]);var y=v.metallicFactor;null!=y&&(n.metallic=y);var g=v.roughnessFactor;null!=g&&(n.roughness=g)}return n}function er(e,t){var r=t.mesh;if(r&&(r.instances=r.instances?r.instances+1:1),t.children)for(var n=t.children,o=0,i=n.length;o<i;o++){var a=n[o];a?er(e,a):e.error("Node not found: "+o)}}var tr=[];function rr(e,t,r,n){var o,i=e.xktModel;if(t.matrix&&(o=t.matrix,n=n?_.mulMat4(n,o,_.mat4()):o),t.translation&&(o=_.translationMat4v(t.translation),n=n?_.mulMat4(n,o,_.mat4()):o),t.rotation&&(o=_.quaternionToMat4(t.rotation),n=n?_.mulMat4(n,o,_.mat4()):o),t.scale&&(o=_.scalingMat4v(t.scale),n=n?_.mulMat4(n,o,_.mat4()):o),t.mesh){var a=t.mesh,s=a.primitives.length;if(s>0)for(var u=0;u<s;u++){var c=a.primitives[u];if(!c._xktGeometryId){var l="geometry-"+e.nextId++,h={geometryId:l};switch(c.mode){case 0:h.primitiveType="points";break;case 1:h.primitiveType="lines";break;case 2:h.primitiveType="line-loop";break;case 3:h.primitiveType="line-strip";break;case 4:default:h.primitiveType="triangles";break;case 5:h.primitiveType="triangle-strip";break;case 6:h.primitiveType="triangle-fan"}if(!c.attributes.POSITION)continue;h.positions=c.attributes.POSITION.value,e.stats.numVertices+=h.positions.length/3,e.includeNormals&&c.attributes.NORMAL&&(h.normals=c.attributes.NORMAL.value,e.stats.numNormals+=h.normals.length/3),c.attributes.COLOR_0&&(h.colorsCompressed=c.attributes.COLOR_0.value),e.includeTextures&&c.attributes.TEXCOORD_0&&(h.uvs=c.attributes.TEXCOORD_0.value,e.stats.numUVs+=h.uvs.length/2),c.indices&&(h.indices=c.indices.value,4===c.mode&&(e.stats.numTriangles+=h.indices.length/3)),i.createGeometry(h),c._xktGeometryId=l,e.stats.numGeometries++}var f=e.nextId++,d={meshId:f,geometryId:c._xktGeometryId,matrix:n?n.slice():_.identityMat4()},p=c.material;p?(d.textureSetId=p._textureSetId,d.color=p._attributes.color,d.opacity=p._attributes.opacity,d.metallic=p._attributes.metallic,d.roughness=p._attributes.roughness):(d.color=[1,1,1],d.opacity=1),i.createMesh(d),tr.push(f)}}if(t.children)for(var v=t.children,m=0,y=v.length;m<y;m++)rr(e,v[m],r+1,n);var g=t.name;if((null!=g||0===r)&&tr.length>0){null==g&&e.log("Warning: 'name' properties not found on glTF scene nodes - will randomly-generate object IDs in XKT");var x=g;for(x&&i.entities[x]&&e.log("Warning: Two or more glTF nodes found with same 'name' attribute: '".concat(g," - will randomly-generating an object ID in XKT"));!x||i.entities[x];)x="entity-"+e.nextId++;if(e.metaModelCorrections){var b=e.metaModelCorrections.eachChildRoot[x];if(b){var w=e.metaModelCorrections.eachRootStats[b.id];w.countChildren++,w.countChildren>=w.numChildren&&(i.createEntity({entityId:b.id,meshIds:tr}),e.stats.numObjects++,tr.length=0)}else e.metaModelCorrections.metaObjectsMap[x]&&(i.createEntity({entityId:x,meshIds:tr}),e.stats.numObjects++,tr.length=0)}else i.createEntity({entityId:x,meshIds:tr}),e.stats.numObjects++,tr.length=0}}var nr="undefined"!=typeof atob?atob:function(e){return Buffer.from(e,"base64").toString("binary")},or={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},ir={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function ar(e){var t=e.data,r=e.xktModel,n=e.metaModelData,o=e.includeNormals,i=e.reuseGeometries,a=e.getAttachment,s=e.stats,u=void 0===s?{}:s,c=e.log;return c&&c("Using parser: parseGLTFJSONIntoXKTModel"),new Promise((function(e,s){if(t)if(r){u.sourceFormat="glTF",u.schemaVersion="2.0",u.title="",u.author="",u.created="",u.numTriangles=0,u.numVertices=0,u.numNormals=0,u.numObjects=0,u.numGeometries=0;var l={gltf:t,metaModelCorrections:n?sr(n):null,getAttachment:a||function(){throw new Error("You must define getAttachment() method to convert glTF with external resources")},log:c||function(e){},xktModel:r,includeNormals:o,createXKTGeometryIds:{},nextMeshId:0,reuseGeometries:!1!==i,stats:u};l.log("Parsing normals: ".concat(l.includeNormals?"enabled":"disabled")),function(e){var t=e.gltf.buffers;return t?Promise.all(t.map((function(t){return function(e,t){return new Promise((function(r,n){if(t._arrayBuffer)return t._buffer=t._arrayBuffer,void r(t);var o=t.uri;o?function(e,t){return new Promise((function(r,n){var o=t.match(/^data:(.*?)(;base64)?,(.*)$/);if(o){var i=!!o[2],a=o[3];a=decodeURIComponent(a),i&&(a=nr(a));for(var s=new ArrayBuffer(a.length),u=new Uint8Array(s),c=0;c<a.length;c++)u[c]=a.charCodeAt(c);r(s)}else e.getAttachment(t).then((function(e){r(e)}),(function(e){n(e)}))}))}(e,o).then((function(e){t._buffer=e,r(e)}),(function(e){n(e)})):n("gltf/handleBuffer missing uri in "+JSON.stringify(t))}))}(e,t)}))):new Promise((function(e,t){e()}))}(l).then((function(){!function(e){var t=e.gltf.bufferViews;if(t)for(var r=0,n=t.length;r<n;r++)ur(e,t[r])}(l),function(e){var t=e.gltf.buffers;if(t)for(var r=0,n=t.length;r<n;r++)t[r]._buffer=null}(l),function(e){var t=e.gltf.materials;if(t)for(var r=0,n=t.length;r<n;r++){var o=t[r],i=cr(0,o);o._materialData=i}}(l),function(e){var t=e.gltf.scene||0,r=e.gltf.scenes[t];if(!r)throw new Error("glTF has no default scene");!function(e,t){var r=t.nodes;if(r)for(var n=0,o=r.length;n<o;n++){var i=e.gltf.nodes[r[n]];i&&hr(e,i,0,null)}}(e,r)}(l),e()}),(function(e){s(e)}))}else s("Argument expected: xktModel");else s("Argument expected: data")}))}function sr(e){for(var t={},r={},n=e.metaObjects||[],o={},i=0,a=n.length;i<a;i++){var s=n[i];o[s.id]=s}for(var u=0,c=n.length;u<c;u++){var l=n[u];if(void 0!==l.parent&&null!==l.parent){var h=o[l.parent];if(l.type===h.type){for(var f=h;f.parent&&o[f.parent].type===f.type;)f=o[f.parent];(t[f.id]||(t[f.id]={numChildren:0,countChildren:0})).numChildren++,r[l.id]=f}}}return{metaObjectsMap:o,eachRootStats:t,eachChildRoot:r}}function ur(e,t){var r=e.gltf.buffers[t.buffer];t._typedArray=null;var n=t.byteLength||0,o=t.byteOffset||0;t._buffer=r._buffer.slice(o,o+n)}function cr(e,t){var r={color:new Float32Array([1,1,1]),opacity:1,metallic:0,roughness:1},n=t.extensions;if(n){var o=n.KHR_materials_pbrSpecularGlossiness;if(o){var i=o.diffuseFactor;null!=i&&(r.color[0]=i[0],r.color[1]=i[1],r.color[2]=i[2])}var a=n.KHR_materials_common;if(a){var s=a.technique,u=a.values||{},c="BLINN"===s,l="PHONG"===s,h="LAMBERT"===s,f=u.diffuse;f&&(c||l||h)&&(Zt.isString(f)||(r.color[0]=f[0],r.color[1]=f[1],r.color[2]=f[2]));var d=u.transparency;null!=d&&(r.opacity=d);var p=u.transparent;null!=p&&(r.opacity=p)}}var v=t.pbrMetallicRoughness;if(v){var m=v.baseColorFactor;m&&(r.color[0]=m[0],r.color[1]=m[1],r.color[2]=m[2],r.opacity=m[3]);var y=v.metallicFactor;null!=y&&(r.metallic=y);var g=v.roughnessFactor;null!=g&&(r.roughness=g)}return r}var lr=[];function hr(e,t,r,n){var o,i=e.gltf,a=e.xktModel;t.matrix&&(o=t.matrix,n=n?_.mulMat4(n,o,_.mat4()):o),t.translation&&(o=_.translationMat4v(t.translation),n=n?_.mulMat4(n,o,o):o),t.rotation&&(o=_.quaternionToMat4(t.rotation),n=n?_.mulMat4(n,o,o):o),t.scale&&(o=_.scalingMat4v(t.scale),n=n?_.mulMat4(n,o,o):o);var s=t.mesh;if(void 0!==s){var u=i.meshes[s];if(u){var c=u.primitives.length;if(c>0)for(var l=0;l<c;l++){var h=u.primitives[l],f=fr(h),d=e.createXKTGeometryIds[f];if(!e.reuseGeometries||!d){d="geometry-"+e.nextMeshId++;var p={};dr(e,h,p);var v=p.colors,m=void 0;if(p.colors){m=[];for(var y=0,g=v.length;y<g;y+=4)m.push(v[y+0]),m.push(v[y+1]),m.push(v[y+2]),m.push(255)}a.createGeometry({geometryId:d,primitiveType:p.primitive,positions:p.positions,normals:e.includeNormals?p.normals:null,colorsCompressed:m,indices:p.indices}),e.stats.numGeometries++,e.stats.numVertices+=p.positions?p.positions.length/3:0,e.stats.numNormals+=e.includeNormals&&p.normals?p.normals.length/3:0,e.stats.numTriangles+=p.indices?p.indices.length/3:0,e.createXKTGeometryIds[f]=d}var x=h.material,b=null!=x?i.materials[x]:null,w=b?b._materialData.color:new Float32Array([1,1,1,1]),M=b?b._materialData.opacity:1,T=b?b._materialData.metallic:0,I=b?b._materialData.roughness:1,S="mesh-"+e.nextMeshId++;a.createMesh({meshId:S,geometryId:d,matrix:n?n.slice():_.identityMat4(),color:w,opacity:M,metallic:T,roughness:I}),lr.push(S)}}}if(t.children)for(var A=t.children,O=0,L=A.length;O<L;O++){var P=A[O],E=i.nodes[P];E?hr(e,E,r+1,n):console.warn("Node not found: "+O)}var j=t.name;if((null!=j||0===r)&&lr.length>0){null==j&&e.log("[parseGLTFJSONIntoXKTModel] Warning: 'name' properties not found on glTF scene nodes - will randomly-generate object IDs in XKT");var G=j;if(null==G)for(a.entities[G]&&e.error("Two or more glTF nodes found with same 'name' attribute: '"+j+"'");!G||a.entities[G];)G="entity-"+e.nextId++;if(e.metaModelCorrections){var k=e.metaModelCorrections.eachChildRoot[G];if(k){var D=e.metaModelCorrections.eachRootStats[k.id];D.countChildren++,D.countChildren>=D.numChildren&&(a.createEntity({entityId:k.id,meshIds:lr}),e.stats.numObjects++,lr=[])}else e.metaModelCorrections.metaObjectsMap[G]&&(a.createEntity({entityId:G,meshIds:lr}),e.stats.numObjects++,lr=[])}else a.createEntity({entityId:G,meshIds:lr}),e.stats.numObjects++,lr=[]}}function fr(e){if(!e.attributes)return"empty";var t=e.mode,r=(e.material,e.indices),n=e.attributes.POSITION,o=e.attributes.NORMAL,i=e.attributes.COLOR_0,a=e.attributes.TEXCOORD_0;return[t,null!=r?r:"-",null!=n?n:"-",null!=o?o:"-",null!=i?i:"-",null!=a?a:"-"].join(";")}function dr(e,t,r){var n=t.attributes;if(n){switch(t.mode){case 0:r.primitive="points";break;case 1:case 2:case 3:r.primitive="lines";break;case 4:default:r.primitive="triangles";break;case 5:console.log("TRIANGLE_STRIP"),r.primitive="triangles";break;case 6:console.log("TRIANGLE_FAN"),r.primitive="triangles"}var o=e.gltf.accessors,i=t.indices;if(null!=i){var a=o[i];r.indices=pr(e,a)}var s=n.POSITION;if(null!=s){var u=o[s];r.positions=pr(e,u)}var c=n.NORMAL;if(null!=c){var l=o[c];r.normals=pr(e,l)}var h=n.COLOR_0;if(null!=h){var f=o[h];r.colors=pr(e,f)}}}function pr(e,t){var r=e.gltf.bufferViews[t.bufferView],n=ir[t.type],o=or[t.componentType],i=o.BYTES_PER_ELEMENT*n;if(t.byteStride&&t.byteStride!==i)throw new Error("interleaved buffer!");return new o(r._buffer,t.byteOffset||0,t.count*n)}function vr(e){var t=e.WebIFC,r=e.data,n=e.xktModel,o=e.autoNormals,i=void 0===o||o,a=e.includeTypes,s=e.excludeTypes,u=e.wasmPath,c=e.stats,l=void 0===c?{}:c,h=e.log;return h&&h("Using parser: parseIFCIntoXKTModel"),new Promise((function(e,o){if(r)if(n)if(u){var c=new t.IfcAPI;u&&c.SetWasmPath(u),c.Init().then((function(){var o=new Uint8Array(r),u=c.OpenModel(o);l.sourceFormat="IFC",l.schemaVersion="",l.title="",l.author="",l.created="",l.numMetaObjects=0,l.numPropertySets=0,l.numObjects=0,l.numGeometries=0,l.numTriangles=0,l.numVertices=0;var f={WebIFC:t,modelID:u,ifcAPI:c,xktModel:n,autoNormals:i,log:h||function(e){},nextId:0,stats:l};if(a){f.includeTypes={};for(var d=0,p=a.length;d<p;d++)f.includeTypes[a[d]]=!0}if(s){f.excludeTypes={};for(var v=0,m=s.length;v<m;v++)f.excludeTypes[s[v]]=!0}var y=f.ifcAPI.GetLineIDsWithType(u,t.IFCPROJECT).get(0);f.ifcAPI.GetLine(u,y),f.xktModel.schema="",f.xktModel.modelId=""+u,f.xktModel.projectId=""+y,function(e){var t=e.ifcAPI.GetLineIDsWithType(e.modelID,e.WebIFC.IFCPROJECT).get(0),r=e.ifcAPI.GetLine(e.modelID,t);mr(e,r)}(f),function(e){for(var t=e.ifcAPI.LoadAllGeometry(e.modelID),r=0,n=t.size();r<n;r++)gr(e,t.get(r));for(var o=e.ifcAPI.GetLineIDsWithType(e.modelID,e.WebIFC.IFCSPACE),i=0,a=o.size();i<a;i++){var s=o.get(i),u=e.ifcAPI.GetFlatMesh(e.modelID,s);gr(e,u)}}(f),function(e){for(var t=e.ifcAPI.GetLineIDsWithType(e.modelID,e.WebIFC.IFCRELDEFINESBYPROPERTIES),r=0;r<t.size();r++){var n=t.get(r),o=e.ifcAPI.GetLine(e.modelID,n,!0);if(o){var i=o.RelatingPropertyDefinition;if(!i)continue;var a=i.GlobalId.value,s=o.RelatedObjects;if(s)for(var u=0,c=s.length;u<c;u++){var l=s[u].GlobalId.value,h=e.xktModel.metaObjects[l];h&&(h.propertySetIds||(h.propertySetIds=[]),h.propertySetIds.push(a))}var f=i.HasProperties;if(f&&f.length>0){for(var d=i.Name.value,p=[],v=0,m=f.length;v<m;v++){var y=f[v],g=y.Name,x=y.NominalValue;if(g&&x){var b={name:g.value,type:x.type,value:x.value,valueType:x.valueType};y.Description?b.description=y.Description.value:x.description&&(b.description=x.description),p.push(b)}}e.xktModel.createPropertySet({propertySetId:a,propertySetType:"Default",propertySetName:d,properties:p}),e.stats.numPropertySets++}}}}(f),e()})).catch((function(e){o(e)}))}else o("Argument expected: wasmPath");else o("Argument expected: xktModel");else o("Argument expected: data")}))}function mr(e,t,r){var n=t.__proto__.constructor.name;if((!e.includeTypes||e.includeTypes[n])&&(!e.excludeTypes||!e.excludeTypes[n])){!function(e,t,r){var n=t.GlobalId.value,o=t.__proto__.constructor.name,i=t.Name&&""!==t.Name.value?t.Name.value:o;e.xktModel.createMetaObject({metaObjectId:n,propertySetIds:null,metaObjectType:o,metaObjectName:i,parentMetaObjectId:r}),e.stats.numMetaObjects++}(e,t,r);var o=t.GlobalId.value;yr(e,t.expressID,"RelatingObject","RelatedObjects",e.WebIFC.IFCRELAGGREGATES,o),yr(e,t.expressID,"RelatingStructure","RelatedElements",e.WebIFC.IFCRELCONTAINEDINSPATIALSTRUCTURE,o)}}function yr(e,t,r,n,o,i){for(var a=e.ifcAPI.GetLineIDsWithType(e.modelID,o),s=0;s<a.size();s++){var u=a.get(s),c=e.ifcAPI.GetLine(e.modelID,u),l=c[r];if(Array.isArray(l)?l.map((function(e){return e.value})).includes(t):l.value===t){var h=c[n];if(Array.isArray(h))h.forEach((function(t){var r=e.ifcAPI.GetLine(e.modelID,t.value);mr(e,r,i)}));else{var f=e.ifcAPI.GetLine(e.modelID,h.value);mr(e,f,i)}}}}function gr(e,t){var r=t.expressID,n=t.geometries,o=[],i=e.ifcAPI.GetLine(e.modelID,r).GlobalId.value,a=i,s=e.xktModel.metaObjects[a];if(!e.includeTypes||s&&e.includeTypes[s.metaObjectType])if(!e.excludeTypes||s&&!e.excludeTypes[s.metaObjectType]){for(var u=0,c=n.size();u<c;u++){var l=n.get(u),h=""+l.geometryExpressID;if(!e.xktModel.geometries[h]){for(var f=e.ifcAPI.GetGeometry(e.modelID,l.geometryExpressID),d=e.ifcAPI.GetVertexArray(f.GetVertexData(),f.GetVertexDataSize()),p=e.ifcAPI.GetIndexArray(f.GetIndexData(),f.GetIndexDataSize()),v=[],m=[],y=0,g=d.length/6;y<g;y++)v.push(d[6*y+0]),v.push(d[6*y+1]),v.push(d[6*y+2]);if(!e.autoNormals)for(var x=0,b=d.length/6;x<b;x++)m.push(d[6*x+3]),m.push(d[6*x+4]),m.push(d[6*x+5]);e.xktModel.createGeometry({geometryId:h,primitiveType:"triangles",positions:v,normals:e.autoNormals?null:m,indices:p}),e.stats.numGeometries++,e.stats.numVertices+=v.length/3,e.stats.numTriangles+=p.length/3}var w="mesh"+e.nextId++;e.xktModel.createMesh({meshId:w,geometryId:h,matrix:l.flatTransformation,color:[l.color.x,l.color.y,l.color.z],opacity:l.color.w}),o.push(w)}o.length>0&&(e.xktModel.createEntity({entityId:i,meshIds:o}),e.stats.numObjects++)}else console.log("excluding: "+a)}const xr=require("@loaders.gl/las");var br=5e5;function wr(e){var t=e.data,r=e.xktModel,n=e.center,o=void 0!==n&&n,i=e.transform,a=void 0===i?null:i,s=e.colorDepth,u=void 0===s?"auto":s,c=e.fp64,l=void 0!==c&&c,h=e.skip,f=void 0===h?1:h,d=e.stats,p=e.log,v=void 0===p?function(){}:p;return v&&v("Using parser: parseLASIntoXKTModel"),new Promise((function(e,n){t?r?(v("Converting LAZ/LAS"),v("center: ".concat(o)),a&&v("transform: [".concat(a,"]")),v("colorDepth: ".concat(u)),v("fp64: ".concat(l)),v("skip: ".concat(f)),(0,Ce.parse)(t,xr.LASLoader,{las:{colorDepth:u,fp64:l}}).then((function(t){var n=t.attributes,i=t.loaderData,s=void 0!==i.pointsFormatId?i.pointsFormatId:-1;if(n.POSITION){var u={};switch(s){case 0:if(!n.intensity)return void v("No intensities found in file (expected for LAS point format 0)");u=y(n.POSITION,n.intensity);break;case 1:if(!n.intensity)return void v("No intensities found in file (expected for LAS point format 1)");u=y(n.POSITION,n.intensity);break;case 2:if(!n.intensity)return void v("No intensities found in file (expected for LAS point format 2)");u=m(n.POSITION,n.COLOR_0,n.intensity);break;case 3:if(!n.intensity)return void v("No intensities found in file (expected for LAS point format 3)");u=m(n.POSITION,n.COLOR_0,n.intensity)}for(var c=g(function(e){if(e){if(o){for(var t=_.vec3(),r=e.length,n=0,i=e.length;n<i;n+=3)t[0]+=e[n+0],t[1]+=e[n+1],t[2]+=e[n+2];t[0]/=r,t[1]/=r,t[2]/=r;for(var s=0,u=e.length;s<u;s+=3)e[s+0]-=t[0],e[s+1]-=t[1],e[s+2]-=t[2]}if(a)for(var c=_.mat4(a),l=_.vec3(),h=0,f=e.length;h<f;h+=3)l[0]=e[h+0],l[1]=e[h+1],l[2]=e[h+2],_.transformPoint3(c,l,l),e[h+0]=l[0],e[h+1]=l[1],e[h+2]=l[2]}return e}(u.positions),3*br),l=g(u.colors,4*br),h=[],f=0,p=c.length;f<p;f++){var x="geometry-".concat(f),b="mesh-".concat(f);h.push(b),r.createGeometry({geometryId:x,primitiveType:"points",positions:c[f],colorsCompressed:l[f]}),r.createMesh({meshId:b,geometryId:x})}var w=_.createUUID();r.createEntity({entityId:w,meshIds:h});var M=_.createUUID();r.createMetaObject({metaObjectId:M,metaObjectType:"Model",metaObjectName:"Model"}),r.createMetaObject({metaObjectId:w,metaObjectType:"PointCloud",metaObjectName:"PointCloud (LAZ)",parentMetaObjectId:M}),d&&(d.sourceFormat="LAS",d.schemaVersion="",d.title="",d.author="",d.created="",d.numMetaObjects=2,d.numPropertySets=0,d.numObjects=1,d.numGeometries=1,d.numVertices=u.positions.length/3),e()}else v("No positions found in file (expected for all LAS point formats)")}),(function(e){n(e)}))):n("Argument expected: xktModel"):n("Argument expected: data")}));function m(e,t,r){for(var n=e.value,o=t.value,i=t.size,a=r.value,s=4*a.length,u=[],c=new Uint8Array(s/f),l=f,h=0,d=0,p=0,v=0,m=0,y=a.length;h<y;h++,d+=i,p+=3)l<=0?(c[v++]=o[d+0],c[v++]=o[d+1],c[v++]=o[d+2],c[v++]=Math.round(a[h]/65536*255),u[m++]=n[p+0],u[m++]=n[p+1],u[m++]=n[p+2],l=f):l--;return{positions:u,colors:c}}function y(e,t){for(var r=e.value,n=t.intensity,o=4*n.length,i=[],a=new Uint8Array(o/f),s=f,u=0,c=0,l=0,h=0,d=n.length;u<d;u++,c+=3)s<=0?(a[l++]=0,a[l++]=0,a[l++]=0,a[l++]=Math.round(n[u]/65536*255),i[h++]=r[c+0],i[h++]=r[c+1],i[h++]=r[c+2],s=f):s--;return{positions:i,colors:a}}function g(e,t){if(t>=e.length)return[e];for(var r=[],n=0;n<e.length;n+=t)r.push(e.slice(n,n+t));return r}}function Mr(e){var t=e.metaModelData,r=e.xktModel,n=e.includeTypes,o=e.excludeTypes,i=e.log;return i&&i("Using parser: parseMetaModelIntoXKTModel"),new Promise((function(e,a){var s,u,c=t.metaObjects||[],l=t.propertySets||[];r.modelId=t.revisionId||"",r.projectId=t.projectId||"",r.revisionId=t.revisionId||"",r.author=t.author||"",r.createdAt=t.createdAt||"",r.creatingApplication=t.creatingApplication||"",r.schema=t.schema||"";for(var h=0,f=l.length;h<f;h++){var d=l[h];r.createPropertySet({propertySetId:d.id,propertySetName:d.name,propertySetType:d.type,properties:d.properties})}if(n){s={};for(var p=0,v=n.length;p<v;p++)s[n[p]]=!0}if(o){u={};for(var m=0,y=o.length;m<y;m++)u[o[m]]=!0}for(var g={},x=0,b=c.length;x<b;x++){var w=c[x];g[w.id]=w}for(var M=0,T=0,I=c.length;T<I;T++){var S=c[T],A=S.type;if((!u||!u[A])&&(!s||s[A])){if(void 0!==S.parent&&null!==S.parent){var O=g[S.parent];if(S.type===O.type)continue}var L=[];if(S.propertySetIds)for(var P=0,E=S.propertySetIds.length;P<E;P++){var j=S.propertySetIds[P];null!=j&&""!==j&&L.push(j)}void 0!==S.propertySetId&&null!==S.propertySetId&&""!==S.propertySetId&&L.push(S.propertySetId),r.createMetaObject({metaObjectId:S.id,metaObjectType:S.type,metaObjectName:S.name,parentMetaObjectId:S.parent,propertySetIds:L.length>0?L:null}),M++}}i&&i("Converted meta objects: "+M),e()}))}function Tr(e){var t=e.data,r=e.xktModel,n=e.littleEndian,o=void 0===n||n,i=e.stats,a=e.log;return a&&a("Using parser: parsePCDIntoXKTModel"),new Promise((function(e,n){var s=function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",r=0,n=e.length;r<n;r++)t+=String.fromCharCode(e[r]);try{return decodeURIComponent(escape(t))}catch(e){return t}}(new Uint8Array(t)),u=function(e){var t={},r=e.search(/[\r\n]DATA\s(\S*)\s/i),n=/[\r\n]DATA\s(\S*)\s/i.exec(e.substr(r-1));if(t.data=n[1],t.headerLen=n[0].length+r,t.str=e.substr(0,t.headerLen),t.str=t.str.replace(/\#.*/gi,""),t.version=/VERSION (.*)/i.exec(t.str),t.fields=/FIELDS (.*)/i.exec(t.str),t.size=/SIZE (.*)/i.exec(t.str),t.type=/TYPE (.*)/i.exec(t.str),t.count=/COUNT (.*)/i.exec(t.str),t.width=/WIDTH (.*)/i.exec(t.str),t.height=/HEIGHT (.*)/i.exec(t.str),t.viewpoint=/VIEWPOINT (.*)/i.exec(t.str),t.points=/POINTS (.*)/i.exec(t.str),null!==t.version&&(t.version=parseFloat(t.version[1])),null!==t.fields&&(t.fields=t.fields[1].split(" ")),null!==t.type&&(t.type=t.type[1].split(" ")),null!==t.width&&(t.width=parseInt(t.width[1])),null!==t.height&&(t.height=parseInt(t.height[1])),null!==t.viewpoint&&(t.viewpoint=t.viewpoint[1]),null!==t.points&&(t.points=parseInt(t.points[1],10)),null===t.points&&(t.points=t.width*t.height),null!==t.size&&(t.size=t.size[1].split(" ").map((function(e){return parseInt(e,10)}))),null!==t.count)t.count=t.count[1].split(" ").map((function(e){return parseInt(e,10)}));else{t.count=[];for(var o=0,i=t.fields.length;o<i;o++)t.count.push(1)}t.offset={};for(var a=0,s=0,u=t.fields.length;s<u;s++)"ascii"===t.data?t.offset[t.fields[s]]=s:(t.offset[t.fields[s]]=a,a+=t.size[s]*t.count[s]);return t.rowSize=a,t}(s),c=[],l=[];if("ascii"===u.data)for(var h=u.offset,f=s.substr(u.headerLen).split("\n"),d=0,p=f.length;d<p;d++)if(""!==f[d]){var v=f[d].split(" ");if(void 0!==h.x&&(c.push(parseFloat(v[h.x])),c.push(parseFloat(v[h.y])),c.push(parseFloat(v[h.z]))),void 0!==h.rgb){var m=parseFloat(v[h.rgb]),y=m>>16&255,g=m>>8&255,x=m>>0&255;l.push(y,g,x,255)}else l.push(255),l.push(255),l.push(255)}if("binary_compressed"===u.data)for(var b=new Uint32Array(t.slice(u.headerLen,u.headerLen+8)),w=b[0],M=b[1],T=function(e,t){var r,n,o,i=e.length,a=new Uint8Array(t),s=0,u=0;do{if((r=e[s++])<32){if(u+ ++r>t)throw new Error("Output buffer is not large enough");if(s+r>i)throw new Error("Invalid compressed data");do{a[u++]=e[s++]}while(--r)}else{if(n=r>>5,o=u-((31&r)<<8)-1,s>=i)throw new Error("Invalid compressed data");if(7===n&&(n+=e[s++],s>=i))throw new Error("Invalid compressed data");if(o-=e[s++],u+n+2>t)throw new Error("Output buffer is not large enough");if(o<0)throw new Error("Invalid compressed data");if(o>=u)throw new Error("Invalid compressed data");do{a[u++]=a[o++]}while(2+--n)}}while(s<i);return a}(new Uint8Array(t,u.headerLen+8,w),M),I=new DataView(T.buffer),S=u.offset,A=0;A<u.points;A++)void 0!==S.x&&(c.push(I.getFloat32(u.points*S.x+u.size[0]*A,o)),c.push(I.getFloat32(u.points*S.y+u.size[1]*A,o)),c.push(I.getFloat32(u.points*S.z+u.size[2]*A,o))),void 0!==S.rgb?(l.push(I.getUint8(u.points*S.rgb+u.size[3]*A+0)),l.push(I.getUint8(u.points*S.rgb+u.size[3]*A+1)),l.push(I.getUint8(u.points*S.rgb+u.size[3]*A+2))):(l.push(1),l.push(1),l.push(1));if("binary"===u.data)for(var O=new DataView(t,u.headerLen),L=u.offset,P=0,E=0;P<u.points;P++,E+=u.rowSize)void 0!==L.x&&(c.push(O.getFloat32(E+L.x,o)),c.push(O.getFloat32(E+L.y,o)),c.push(O.getFloat32(E+L.z,o))),void 0!==L.rgb?(l.push(O.getUint8(E+L.rgb+2)),l.push(O.getUint8(E+L.rgb+1)),l.push(O.getUint8(E+L.rgb+0))):(l.push(255),l.push(255),l.push(255));r.createGeometry({geometryId:"pointsGeometry",primitiveType:"points",positions:c,colors:l&&l.length>0?l:null}),r.createMesh({meshId:"pointsMesh",geometryId:"pointsGeometry"}),r.createEntity({entityId:"geometries",meshIds:["pointsMesh"]}),a&&(a("Converted drawable objects: 1"),a("Converted geometries: 1"),a("Converted vertices: "+c.length/3)),i&&(i.sourceFormat="PCD",i.schemaVersion="",i.title="",i.author="",i.created="",i.numObjects=1,i.numGeometries=1,i.numVertices=c.length/3),e()}))}const Ir=require("@loaders.gl/ply");function Sr(e){return Sr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Sr(e)}function Ar(){Ar=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function c(e,t,r,o){var i=t&&t.prototype instanceof f?t:f,a=Object.create(i.prototype),s=new S(o||[]);return n(a,"_invoke",{value:w(e,r,s)}),a}function l(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var h={};function f(){}function d(){}function p(){}var v={};u(v,i,(function(){return this}));var m=Object.getPrototypeOf,y=m&&m(m(A([])));y&&y!==t&&r.call(y,i)&&(v=y);var g=p.prototype=f.prototype=Object.create(v);function x(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){function o(n,i,a,s){var u=l(e[n],e,i);if("throw"!==u.type){var c=u.arg,h=c.value;return h&&"object"==Sr(h)&&r.call(h,"__await")?t.resolve(h.__await).then((function(e){o("next",e,a,s)}),(function(e){o("throw",e,a,s)})):t.resolve(h).then((function(e){c.value=e,a(c)}),(function(e){return o("throw",e,a,s)}))}s(u.arg)}var i;n(this,"_invoke",{value:function(e,r){function n(){return new t((function(t,n){o(e,r,t,n)}))}return i=i?i.then(n,n):n()}})}function w(e,t,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return{value:void 0,done:!0}}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var s=M(a,r);if(s){if(s===h)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=l(e,t,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===h)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}function M(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,M(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),h;var o=l(n,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,h;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,h):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,h)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function I(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function A(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:O}}function O(){return{value:void 0,done:!0}}return d.prototype=p,n(g,"constructor",{value:p,configurable:!0}),n(p,"constructor",{value:d,configurable:!0}),d.displayName=u(p,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===d||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,u(e,s,"GeneratorFunction")),e.prototype=Object.create(g),e},e.awrap=function(e){return{__await:e}},x(b.prototype),u(b.prototype,a,(function(){return this})),e.AsyncIterator=b,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new b(c(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},x(g),u(g,s,"Generator"),u(g,i,(function(){return this})),u(g,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=A,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(I),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,h):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),I(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;I(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:A(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),h}},e}function Or(e,t,r,n,o,i,a){try{var s=e[i](a),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function Lr(e){return Pr.apply(this,arguments)}function Pr(){var e;return e=Ar().mark((function e(t){var r,n,o,i,a,s,u,c,l,h,f;return Ar().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.data,n=t.xktModel,o=t.stats,(i=t.log)&&i("Using parser: parsePLYIntoXKTModel"),r){e.next=4;break}throw"Argument expected: data";case 4:if(n){e.next=6;break}throw"Argument expected: xktModel";case 6:return e.prev=6,e.next=9,(0,Ce.parse)(r,Ir.PLYLoader);case 9:a=e.sent,e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(6),i&&i("Error: "+e.t0),e.abrupt("return");case 16:if(s=a.attributes,u=!!s.COLOR_0){for(c=u?s.COLOR_0.value:null,l=[],h=0,f=c.length;h<f;h+=4)l.push(c[h]),l.push(c[h+1]),l.push(c[h+2]);n.createGeometry({geometryId:"plyGeometry",primitiveType:"triangles",positions:s.POSITION.value,indices:a.indices?a.indices.value:[],colorsCompressed:l})}else n.createGeometry({geometryId:"plyGeometry",primitiveType:"triangles",positions:s.POSITION.value,indices:a.indices?a.indices.value:[]});n.createMesh({meshId:"plyMesh",geometryId:"plyGeometry",color:u?null:[1,1,1]}),n.createEntity({entityId:"ply",meshIds:["plyMesh"]}),o&&(o.sourceFormat="PLY",o.schemaVersion="",o.title="",o.author="",o.created="",o.numMetaObjects=2,o.numPropertySets=0,o.numObjects=1,o.numGeometries=1,o.numVertices=s.POSITION.value.length/3);case 22:case"end":return e.stop()}}),e,null,[[6,12]])})),Pr=function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){Or(i,n,o,a,s,"next",e)}function s(e){Or(i,n,o,a,s,"throw",e)}a(void 0)}))},Pr.apply(this,arguments)}function Er(e){return Er="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Er(e)}function jr(){jr=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function c(e,t,r,o){var i=t&&t.prototype instanceof f?t:f,a=Object.create(i.prototype),s=new S(o||[]);return n(a,"_invoke",{value:w(e,r,s)}),a}function l(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var h={};function f(){}function d(){}function p(){}var v={};u(v,i,(function(){return this}));var m=Object.getPrototypeOf,y=m&&m(m(A([])));y&&y!==t&&r.call(y,i)&&(v=y);var g=p.prototype=f.prototype=Object.create(v);function x(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){function o(n,i,a,s){var u=l(e[n],e,i);if("throw"!==u.type){var c=u.arg,h=c.value;return h&&"object"==Er(h)&&r.call(h,"__await")?t.resolve(h.__await).then((function(e){o("next",e,a,s)}),(function(e){o("throw",e,a,s)})):t.resolve(h).then((function(e){c.value=e,a(c)}),(function(e){return o("throw",e,a,s)}))}s(u.arg)}var i;n(this,"_invoke",{value:function(e,r){function n(){return new t((function(t,n){o(e,r,t,n)}))}return i=i?i.then(n,n):n()}})}function w(e,t,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return{value:void 0,done:!0}}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var s=M(a,r);if(s){if(s===h)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=l(e,t,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===h)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}function M(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,M(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),h;var o=l(n,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,h;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,h):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,h)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function I(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function A(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:O}}function O(){return{value:void 0,done:!0}}return d.prototype=p,n(g,"constructor",{value:p,configurable:!0}),n(p,"constructor",{value:d,configurable:!0}),d.displayName=u(p,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===d||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,u(e,s,"GeneratorFunction")),e.prototype=Object.create(g),e},e.awrap=function(e){return{__await:e}},x(b.prototype),u(b.prototype,a,(function(){return this})),e.AsyncIterator=b,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new b(c(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},x(g),u(g,s,"Generator"),u(g,i,(function(){return this})),u(g,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=A,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(I),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,h):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),I(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;I(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:A(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),h}},e}function Gr(e,t,r,n,o,i,a){try{var s=e[i](a),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function kr(e){return _r.apply(this,arguments)}function _r(){var e;return e=jr().mark((function e(t){var r,n,o,i,a,s,u,c;return jr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.data,n=t.splitMeshes,o=t.autoNormals,i=t.smoothNormals,a=t.smoothNormalsAngleThreshold,s=t.xktModel,u=t.stats,(c=t.log)&&c("Using parser: parseSTLIntoXKTModel"),e.abrupt("return",new Promise((function(e,t){if(r)if(s){var l=_.createUUID(),h=s.createMetaObject({metaObjectId:l,metaObjectType:"Model",metaObjectName:"Model"}),f={data:r,splitMeshes:n,autoNormals:o,smoothNormals:i,smoothNormalsAngleThreshold:a,xktModel:s,rootMetaObject:h,nextId:0,log:c||function(e){},stats:{numObjects:0,numGeometries:0,numTriangles:0,numVertices:0}},d=Br(r);Dr(d)?Nr(f,d):Fr(f,"string"!=typeof(p=r)?function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",r=0,n=e.length;r<n;r++)t+=String.fromCharCode(e[r]);return decodeURIComponent(escape(t))}(new Uint8Array(p)):p),u&&(u.sourceFormat="STL",u.schemaVersion="",u.title="",u.author="",u.created="",u.numMetaObjects=2,u.numPropertySets=0,u.numObjects=1,u.numGeometries=1,u.numTriangles=f.stats.numTriangles,u.numVertices=f.stats.numVertices),e()}else t("Argument expected: xktModel");else t("Argument expected: data");var p})));case 3:case"end":return e.stop()}}),e)})),_r=function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){Gr(i,n,o,a,s,"next",e)}function s(e){Gr(i,n,o,a,s,"throw",e)}a(void 0)}))},_r.apply(this,arguments)}function Dr(e){var t=new DataView(e);if(84+50*t.getUint32(80,!0)===t.byteLength)return!0;for(var r=[115,111,108,105,100],n=0;n<5;n++)if(r[n]!==t.getUint8(n,!1))return!0;return!1}function Nr(e,t){for(var r,n,o,i,a,s,u,c=new DataView(t),l=c.getUint32(80,!0),h=!1,f=null,d=null,p=null,v=!1,m=0;m<70;m++)1129270351===c.getUint32(m,!1)&&82===c.getUint8(m+4)&&61===c.getUint8(m+5)&&(h=!0,i=[],a=c.getUint8(m+6)/255,s=c.getUint8(m+7)/255,u=c.getUint8(m+8)/255,c.getUint8(m+9));for(var y=[],g=[],x=e.splitMeshes,b=0;b<l;b++){var w=84+50*b,M=c.getFloat32(w,!0),T=c.getFloat32(w+4,!0),I=c.getFloat32(w+8,!0);if(h){var S=c.getUint16(w+48,!0);0==(32768&S)?(r=(31&S)/31,n=(S>>5&31)/31,o=(S>>10&31)/31):(r=a,n=s,o=u),(x&&r!==f||n!==d||o!==p)&&(null!==f&&(v=!0),f=r,d=n,p=o)}for(var A=1;A<=3;A++){var O=w+12*A;y.push(c.getFloat32(O,!0)),y.push(c.getFloat32(O+4,!0)),y.push(c.getFloat32(O+8,!0)),e.autoNormals||g.push(M,T,I),h&&i.push(r,n,o,1)}x&&v&&(Cr(e,y,g,i),y=[],g=[],i=i?[]:null,v=!1)}y.length>0&&Cr(e,y,g,i)}function Fr(e,t){for(var r,n,o,i,a,s,u,c=/facet([\s\S]*?)endfacet/g,l=0,h=/[\s]+([+-]?(?:\d+.\d+|\d+.|\d+|.\d+)(?:[eE][+-]?\d+)?)/.source,f=new RegExp("vertex"+h+h+h,"g"),d=new RegExp("normal"+h+h+h,"g"),p=[],v=[];null!==(i=c.exec(t));){for(a=0,s=0,u=i[0];null!==(i=d.exec(u));)r=parseFloat(i[1]),n=parseFloat(i[2]),o=parseFloat(i[3]),s++;for(;null!==(i=f.exec(u));)p.push(parseFloat(i[1]),parseFloat(i[2]),parseFloat(i[3])),v.push(r,n,o),a++;if(1!==s)return e.log("Error in normal of face "+l),-1;if(3!==a)return e.log("Error in positions of face "+l),-1;l++}Cr(e,p,v,null)}var Vr=0;function Cr(e,t,r,n){for(var o=new Int32Array(t.length/3),i=0,a=o.length;i<a;i++)o[i]=i;r=r&&r.length>0?r:null,n=n&&n.length>0?n:null,!e.autoNormals&&e.smoothNormals&&function(e,t){var r,n,o,i,a,s,u,c,l,h,f,d=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).smoothNormalsAngleThreshold||20,p={},v=[],m={},y=Math.pow(10,4);for(u=0,l=e.length;u<l;u+=3){s=u/3,n=e[u],o=e[u+1],i=e[u+2],void 0===p[a="".concat(Math.round(n*y),"_").concat(Math.round(o*y),"_").concat(Math.round(i*y))]?p[a]=[s]:p[a].push(s);var g=_.normalizeVec3([t[u],t[u+1],t[u+2]]);v[s]=g,r=_.vec4([g[0],g[1],g[2],1]),m[s]=r}for(a in p)if(p.hasOwnProperty(a)){var x=p[a],b=x.length;for(u=0;u<b;u++){var w=x[u];for(r=m[w],c=0;c<b;c++)if(u!==c){var M=x[c];h=v[w],f=v[M],Math.abs(_.angleVec3(h,f)/_.DEGTORAD)<d&&(r[0]+=f[0],r[1]+=f[1],r[2]+=f[2],r[3]+=1)}}}for(u=0,l=t.length;u<l;u+=3)r=m[u/3],t[u+0]=r[0]/r[3],t[u+1]=r[1]/r[3],t[u+2]=r[2]/r[3]}(t,r,{smoothNormalsAngleThreshold:e.smoothNormalsAngleThreshold});var s=""+Vr++,u=""+Vr++,c=""+Vr++;e.xktModel.createGeometry({geometryId:s,primitiveType:"triangles",positions:t,normals:e.autoNormals?null:r,colors:n,indices:o}),e.xktModel.createMesh({meshId:u,geometryId:s,color:n?null:[1,1,1],metallic:.9,roughness:.1}),e.xktModel.createEntity({entityId:c,meshIds:[u]}),e.xktModel.createMetaObject({metaObjectId:c,metaObjectType:"Default",metaObjectName:"STL Mesh",parentMetaObjectId:e.rootMetaObject.metaObjectId}),e.stats.numGeometries++,e.stats.numObjects++,e.stats.numVertices+=t.length/3,e.stats.numTriangles+=o.length/3}function Br(e){if("string"==typeof e){for(var t=new Uint8Array(e.length),r=0;r<e.length;r++)t[r]=255&e.charCodeAt(r);return t.buffer||t}return e}function zr(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.xSize||1;t<0&&(console.error("negative xSize not allowed - will invert"),t*=-1);var r=e.ySize||1;r<0&&(console.error("negative ySize not allowed - will invert"),r*=-1);var n=e.zSize||1;n<0&&(console.error("negative zSize not allowed - will invert"),n*=-1);var o=e.center,i=o?o[0]:0,a=o?o[1]:0,s=o?o[2]:0,u=-t+i,c=-r+a,l=-n+s,h=t+i,f=r+a,d=n+s;return{primitiveType:"triangles",positions:[h,f,d,u,f,d,u,c,d,h,c,d,h,f,d,h,c,d,h,c,l,h,f,l,h,f,d,h,f,l,u,f,l,u,f,d,u,f,d,u,f,l,u,c,l,u,c,d,u,c,l,h,c,l,h,c,d,u,c,d,h,c,l,u,c,l,u,f,l,h,f,l],normals:[0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1],uv:[1,0,0,0,0,1,1,1,0,0,0,1,1,1,1,0,1,1,1,0,0,0,0,1,1,0,0,0,0,1,1,1,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0],indices:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]}}function Ur(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.xSize||1;t<0&&(console.error("negative xSize not allowed - will invert"),t*=-1);var r=e.ySize||1;r<0&&(console.error("negative ySize not allowed - will invert"),r*=-1);var n=e.zSize||1;n<0&&(console.error("negative zSize not allowed - will invert"),n*=-1);var o=e.center,i=o?o[0]:0,a=o?o[1]:0,s=o?o[2]:0,u=-t+i,c=-r+a,l=-n+s,h=t+i,f=r+a,d=n+s;return{primitiveType:"lines",positions:[u,c,l,u,c,d,u,f,l,u,f,d,h,c,l,h,c,d,h,f,l,h,f,d],indices:[0,1,1,3,3,2,2,0,4,5,5,7,7,6,6,4,0,4,1,5,2,6,3,7]}}function Xr(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.radiusTop||1;t<0&&(console.error("negative radiusTop not allowed - will invert"),t*=-1);var r=e.radiusBottom||1;r<0&&(console.error("negative radiusBottom not allowed - will invert"),r*=-1);var n=e.height||1;n<0&&(console.error("negative height not allowed - will invert"),n*=-1);var o=e.radialSegments||32;o<0&&(console.error("negative radialSegments not allowed - will invert"),o*=-1),o<3&&(o=3);var i=e.heightSegments||1;i<0&&(console.error("negative heightSegments not allowed - will invert"),i*=-1),i<1&&(i=1);var a,s,u,c,l,h,f,d,p,v,m,y=!!e.openEnded,g=e.center,x=g?g[0]:0,b=g?g[1]:0,w=g?g[2]:0,M=n/2,T=n/i,I=2*Math.PI/o,S=1/o,A=(t-r)/i,O=[],L=[],P=[],E=[],j=(90-180*Math.atan(n/(r-t))/Math.PI)/90;for(a=0;a<=i;a++)for(l=t-a*A,h=M-a*T,s=0;s<=o;s++)u=Math.sin(s*I),c=Math.cos(s*I),L.push(l*u),L.push(j),L.push(l*c),P.push(s*S),P.push(1*a/i),O.push(l*u+x),O.push(h+b),O.push(l*c+w);for(a=0;a<i;a++)for(s=0;s<=o;s++)d=(f=a*(o+1)+s)+o,E.push(f),E.push(d),E.push(d+1),E.push(f),E.push(d+1),E.push(f+1);if(!y&&t>0){for(p=O.length/3,L.push(0),L.push(1),L.push(0),P.push(.5),P.push(.5),O.push(0+x),O.push(M+b),O.push(0+w),s=0;s<=o;s++)u=Math.sin(s*I),c=Math.cos(s*I),v=.5*Math.sin(s*I)+.5,m=.5*Math.cos(s*I)+.5,L.push(t*u),L.push(1),L.push(t*c),P.push(v),P.push(m),O.push(t*u+x),O.push(M+b),O.push(t*c+w);for(s=0;s<o;s++)g=p,f=p+1+s,E.push(f),E.push(f+1),E.push(g)}if(!y&&r>0){for(p=O.length/3,L.push(0),L.push(-1),L.push(0),P.push(.5),P.push(.5),O.push(0+x),O.push(0-M+b),O.push(0+w),s=0;s<=o;s++)u=Math.sin(s*I),c=Math.cos(s*I),v=.5*Math.sin(s*I)+.5,m=.5*Math.cos(s*I)+.5,L.push(r*u),L.push(-1),L.push(r*c),P.push(v),P.push(m),O.push(r*u+x),O.push(0-M+b),O.push(r*c+w);for(s=0;s<o;s++)g=p,f=p+1+s,E.push(g),E.push(f+1),E.push(f)}return{primitiveType:"triangles",positions:O,normals:L,uv:P,uvs:P,indices:E}}function Rr(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.size||1;t<0&&(console.error("negative size not allowed - will invert"),t*=-1);var r=e.divisions||1;r<0&&(console.error("negative divisions not allowed - will invert"),r*=-1),r<1&&(r=1);for(var n=(t=t||10)/(r=r||10),o=t/2,i=[],a=[],s=0,u=0,c=-o;u<=r;u++,c+=n)i.push(-o),i.push(0),i.push(c),i.push(o),i.push(0),i.push(c),i.push(c),i.push(0),i.push(-o),i.push(c),i.push(0),i.push(o),a.push(s++),a.push(s++),a.push(s++),a.push(s++);return{primitiveType:"lines",positions:i,indices:a}}function Kr(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.xSize||1;t<0&&(console.error("negative xSize not allowed - will invert"),t*=-1);var r=e.zSize||1;r<0&&(console.error("negative zSize not allowed - will invert"),r*=-1);var n=e.xSegments||1;n<0&&(console.error("negative xSegments not allowed - will invert"),n*=-1),n<1&&(n=1);var o=e.xSegments||1;o<0&&(console.error("negative zSegments not allowed - will invert"),o*=-1),o<1&&(o=1);var i,a,s,u,c,l,h,f=e.center,d=f?f[0]:0,p=f?f[1]:0,v=f?f[2]:0,m=t/2,y=r/2,g=Math.floor(n)||1,x=Math.floor(o)||1,b=g+1,w=x+1,M=t/g,T=r/x,I=new Float32Array(b*w*3),S=new Float32Array(b*w*3),A=new Float32Array(b*w*2),O=0,L=0;for(i=0;i<w;i++){var P=i*T-y;for(a=0;a<b;a++)s=a*M-m,I[O]=s+d,I[O+1]=p,I[O+2]=-P+v,S[O+2]=-1,A[L]=a/g,A[L+1]=(x-i)/x,O+=3,L+=2}O=0;var E=new(I.length/3>65535?Uint32Array:Uint16Array)(g*x*6);for(i=0;i<x;i++)for(a=0;a<g;a++)u=a+b*i,c=a+b*(i+1),l=a+1+b*(i+1),h=a+1+b*i,E[O]=h,E[O+1]=c,E[O+2]=u,E[O+3]=h,E[O+4]=l,E[O+5]=c,O+=6;return{primitiveType:"triangles",positions:I,normals:S,uv:A,uvs:A,indices:E}}function qr(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.lod||1,r=e.center?e.center[0]:0,n=e.center?e.center[1]:0,o=e.center?e.center[2]:0,i=e.radius||1;i<0&&(console.error("negative radius not allowed - will invert"),i*=-1);var a=e.heightSegments||18;a<0&&(console.error("negative heightSegments not allowed - will invert"),a*=-1),(a=Math.floor(t*a))<18&&(a=18);var s=e.widthSegments||18;s<0&&(console.error("negative widthSegments not allowed - will invert"),s*=-1),(s=Math.floor(t*s))<18&&(s=18);var u,c,l,h,f,d,p,v,m,y,g,x,b,w,M=[],T=[],I=[],S=[];for(u=0;u<=a;u++)for(l=u*Math.PI/a,h=Math.sin(l),f=Math.cos(l),c=0;c<=s;c++)d=2*c*Math.PI/s,p=Math.sin(d),v=Math.cos(d)*h,m=f,y=p*h,g=1-c/s,x=u/a,T.push(v),T.push(m),T.push(y),I.push(g),I.push(x),M.push(r+i*v),M.push(n+i*m),M.push(o+i*y);for(u=0;u<a;u++)for(c=0;c<s;c++)w=(b=u*(s+1)+c)+s+1,S.push(b+1),S.push(w+1),S.push(w),S.push(b+1),S.push(w),S.push(b);return{primitiveType:"triangles",positions:M,normals:T,uv:I,uvs:I,indices:S}}function Zr(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.radius||1;t<0&&(console.error("negative radius not allowed - will invert"),t*=-1),t*=.5;var r=e.tube||.3;r<0&&(console.error("negative tube not allowed - will invert"),r*=-1);var n=e.radialSegments||32;n<0&&(console.error("negative radialSegments not allowed - will invert"),n*=-1),n<4&&(n=4);var o=e.tubeSegments||24;o<0&&(console.error("negative tubeSegments not allowed - will invert"),o*=-1),o<4&&(o=4);var i=e.arc||2*Math.PI;i<0&&(console.warn("negative arc not allowed - will invert"),i*=-1),i>360&&(i=360);var a,s,u,c,l,h,f,d,p,v,m,y,g=e.center,x=g?g[0]:0,b=g?g[1]:0,w=g?g[2]:0,M=[],T=[],I=[],S=[];for(d=0;d<=o;d++)for(f=0;f<=n;f++)a=f/n*i,s=.785398+d/o*Math.PI*2,x=t*Math.cos(a),b=t*Math.sin(a),u=(t+r*Math.cos(s))*Math.cos(a),c=(t+r*Math.cos(s))*Math.sin(a),l=r*Math.sin(s),M.push(u+x),M.push(c+b),M.push(l+w),I.push(1-f/n),I.push(d/o),h=_.normalizeVec3(_.subVec3([u,c,l],[x,b,w],[]),[]),T.push(h[0]),T.push(h[1]),T.push(h[2]);for(d=1;d<=o;d++)for(f=1;f<=n;f++)p=(n+1)*d+f-1,v=(n+1)*(d-1)+f-1,m=(n+1)*(d-1)+f,y=(n+1)*d+f,S.push(p),S.push(v),S.push(m),S.push(m),S.push(y),S.push(p);return{primitiveType:"triangles",positions:M,normals:T,uv:I,uvs:I,indices:S}}var Yr={" ":{width:16,points:[]},"!":{width:10,points:[[5,21],[5,7],[-1,-1],[5,2],[4,1],[5,0],[6,1],[5,2]]},'"':{width:16,points:[[4,21],[4,14],[-1,-1],[12,21],[12,14]]},"#":{width:21,points:[[11,25],[4,-7],[-1,-1],[17,25],[10,-7],[-1,-1],[4,12],[18,12],[-1,-1],[3,6],[17,6]]},$:{width:20,points:[[8,25],[8,-4],[-1,-1],[12,25],[12,-4],[-1,-1],[17,18],[15,20],[12,21],[8,21],[5,20],[3,18],[3,16],[4,14],[5,13],[7,12],[13,10],[15,9],[16,8],[17,6],[17,3],[15,1],[12,0],[8,0],[5,1],[3,3]]},"%":{width:24,points:[[21,21],[3,0],[-1,-1],[8,21],[10,19],[10,17],[9,15],[7,14],[5,14],[3,16],[3,18],[4,20],[6,21],[8,21],[10,20],[13,19],[16,19],[19,20],[21,21],[-1,-1],[17,7],[15,6],[14,4],[14,2],[16,0],[18,0],[20,1],[21,3],[21,5],[19,7],[17,7]]},"&":{width:26,points:[[23,12],[23,13],[22,14],[21,14],[20,13],[19,11],[17,6],[15,3],[13,1],[11,0],[7,0],[5,1],[4,2],[3,4],[3,6],[4,8],[5,9],[12,13],[13,14],[14,16],[14,18],[13,20],[11,21],[9,20],[8,18],[8,16],[9,13],[11,10],[16,3],[18,1],[20,0],[22,0],[23,1],[23,2]]},"'":{width:10,points:[[5,19],[4,20],[5,21],[6,20],[6,18],[5,16],[4,15]]},"(":{width:14,points:[[11,25],[9,23],[7,20],[5,16],[4,11],[4,7],[5,2],[7,-2],[9,-5],[11,-7]]},")":{width:14,points:[[3,25],[5,23],[7,20],[9,16],[10,11],[10,7],[9,2],[7,-2],[5,-5],[3,-7]]},"*":{width:16,points:[[8,21],[8,9],[-1,-1],[3,18],[13,12],[-1,-1],[13,18],[3,12]]},"+":{width:26,points:[[13,18],[13,0],[-1,-1],[4,9],[22,9]]},",":{width:10,points:[[6,1],[5,0],[4,1],[5,2],[6,1],[6,-1],[5,-3],[4,-4]]},"-":{width:26,points:[[4,9],[22,9]]},".":{width:10,points:[[5,2],[4,1],[5,0],[6,1],[5,2]]},"/":{width:22,points:[[20,25],[2,-7]]},0:{width:20,points:[[9,21],[6,20],[4,17],[3,12],[3,9],[4,4],[6,1],[9,0],[11,0],[14,1],[16,4],[17,9],[17,12],[16,17],[14,20],[11,21],[9,21]]},1:{width:20,points:[[6,17],[8,18],[11,21],[11,0]]},2:{width:20,points:[[4,16],[4,17],[5,19],[6,20],[8,21],[12,21],[14,20],[15,19],[16,17],[16,15],[15,13],[13,10],[3,0],[17,0]]},3:{width:20,points:[[5,21],[16,21],[10,13],[13,13],[15,12],[16,11],[17,8],[17,6],[16,3],[14,1],[11,0],[8,0],[5,1],[4,2],[3,4]]},4:{width:20,points:[[13,21],[3,7],[18,7],[-1,-1],[13,21],[13,0]]},5:{width:20,points:[[15,21],[5,21],[4,12],[5,13],[8,14],[11,14],[14,13],[16,11],[17,8],[17,6],[16,3],[14,1],[11,0],[8,0],[5,1],[4,2],[3,4]]},6:{width:20,points:[[16,18],[15,20],[12,21],[10,21],[7,20],[5,17],[4,12],[4,7],[5,3],[7,1],[10,0],[11,0],[14,1],[16,3],[17,6],[17,7],[16,10],[14,12],[11,13],[10,13],[7,12],[5,10],[4,7]]},7:{width:20,points:[[17,21],[7,0],[-1,-1],[3,21],[17,21]]},8:{width:20,points:[[8,21],[5,20],[4,18],[4,16],[5,14],[7,13],[11,12],[14,11],[16,9],[17,7],[17,4],[16,2],[15,1],[12,0],[8,0],[5,1],[4,2],[3,4],[3,7],[4,9],[6,11],[9,12],[13,13],[15,14],[16,16],[16,18],[15,20],[12,21],[8,21]]},9:{width:20,points:[[16,14],[15,11],[13,9],[10,8],[9,8],[6,9],[4,11],[3,14],[3,15],[4,18],[6,20],[9,21],[10,21],[13,20],[15,18],[16,14],[16,9],[15,4],[13,1],[10,0],[8,0],[5,1],[4,3]]},":":{width:10,points:[[5,14],[4,13],[5,12],[6,13],[5,14],[-1,-1],[5,2],[4,1],[5,0],[6,1],[5,2]]},";":{width:10,points:[[5,14],[4,13],[5,12],[6,13],[5,14],[-1,-1],[6,1],[5,0],[4,1],[5,2],[6,1],[6,-1],[5,-3],[4,-4]]},"<":{width:24,points:[[20,18],[4,9],[20,0]]},"=":{width:26,points:[[4,12],[22,12],[-1,-1],[4,6],[22,6]]},">":{width:24,points:[[4,18],[20,9],[4,0]]},"?":{width:18,points:[[3,16],[3,17],[4,19],[5,20],[7,21],[11,21],[13,20],[14,19],[15,17],[15,15],[14,13],[13,12],[9,10],[9,7],[-1,-1],[9,2],[8,1],[9,0],[10,1],[9,2]]},"@":{width:27,points:[[18,13],[17,15],[15,16],[12,16],[10,15],[9,14],[8,11],[8,8],[9,6],[11,5],[14,5],[16,6],[17,8],[-1,-1],[12,16],[10,14],[9,11],[9,8],[10,6],[11,5],[-1,-1],[18,16],[17,8],[17,6],[19,5],[21,5],[23,7],[24,10],[24,12],[23,15],[22,17],[20,19],[18,20],[15,21],[12,21],[9,20],[7,19],[5,17],[4,15],[3,12],[3,9],[4,6],[5,4],[7,2],[9,1],[12,0],[15,0],[18,1],[20,2],[21,3],[-1,-1],[19,16],[18,8],[18,6],[19,5]]},A:{width:18,points:[[9,21],[1,0],[-1,-1],[9,21],[17,0],[-1,-1],[4,7],[14,7]]},B:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[13,21],[16,20],[17,19],[18,17],[18,15],[17,13],[16,12],[13,11],[-1,-1],[4,11],[13,11],[16,10],[17,9],[18,7],[18,4],[17,2],[16,1],[13,0],[4,0]]},C:{width:21,points:[[18,16],[17,18],[15,20],[13,21],[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5]]},D:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[11,21],[14,20],[16,18],[17,16],[18,13],[18,8],[17,5],[16,3],[14,1],[11,0],[4,0]]},E:{width:19,points:[[4,21],[4,0],[-1,-1],[4,21],[17,21],[-1,-1],[4,11],[12,11],[-1,-1],[4,0],[17,0]]},F:{width:18,points:[[4,21],[4,0],[-1,-1],[4,21],[17,21],[-1,-1],[4,11],[12,11]]},G:{width:21,points:[[18,16],[17,18],[15,20],[13,21],[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5],[18,8],[-1,-1],[13,8],[18,8]]},H:{width:22,points:[[4,21],[4,0],[-1,-1],[18,21],[18,0],[-1,-1],[4,11],[18,11]]},I:{width:8,points:[[4,21],[4,0]]},J:{width:16,points:[[12,21],[12,5],[11,2],[10,1],[8,0],[6,0],[4,1],[3,2],[2,5],[2,7]]},K:{width:21,points:[[4,21],[4,0],[-1,-1],[18,21],[4,7],[-1,-1],[9,12],[18,0]]},L:{width:17,points:[[4,21],[4,0],[-1,-1],[4,0],[16,0]]},M:{width:24,points:[[4,21],[4,0],[-1,-1],[4,21],[12,0],[-1,-1],[20,21],[12,0],[-1,-1],[20,21],[20,0]]},N:{width:22,points:[[4,21],[4,0],[-1,-1],[4,21],[18,0],[-1,-1],[18,21],[18,0]]},O:{width:22,points:[[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5],[19,8],[19,13],[18,16],[17,18],[15,20],[13,21],[9,21]]},P:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[13,21],[16,20],[17,19],[18,17],[18,14],[17,12],[16,11],[13,10],[4,10]]},Q:{width:22,points:[[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5],[19,8],[19,13],[18,16],[17,18],[15,20],[13,21],[9,21],[-1,-1],[12,4],[18,-2]]},R:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[13,21],[16,20],[17,19],[18,17],[18,15],[17,13],[16,12],[13,11],[4,11],[-1,-1],[11,11],[18,0]]},S:{width:20,points:[[17,18],[15,20],[12,21],[8,21],[5,20],[3,18],[3,16],[4,14],[5,13],[7,12],[13,10],[15,9],[16,8],[17,6],[17,3],[15,1],[12,0],[8,0],[5,1],[3,3]]},T:{width:16,points:[[8,21],[8,0],[-1,-1],[1,21],[15,21]]},U:{width:22,points:[[4,21],[4,6],[5,3],[7,1],[10,0],[12,0],[15,1],[17,3],[18,6],[18,21]]},V:{width:18,points:[[1,21],[9,0],[-1,-1],[17,21],[9,0]]},W:{width:24,points:[[2,21],[7,0],[-1,-1],[12,21],[7,0],[-1,-1],[12,21],[17,0],[-1,-1],[22,21],[17,0]]},X:{width:20,points:[[3,21],[17,0],[-1,-1],[17,21],[3,0]]},Y:{width:18,points:[[1,21],[9,11],[9,0],[-1,-1],[17,21],[9,11]]},Z:{width:20,points:[[17,21],[3,0],[-1,-1],[3,21],[17,21],[-1,-1],[3,0],[17,0]]},"[":{width:14,points:[[4,25],[4,-7],[-1,-1],[5,25],[5,-7],[-1,-1],[4,25],[11,25],[-1,-1],[4,-7],[11,-7]]},"\\":{width:14,points:[[0,21],[14,-3]]},"]":{width:14,points:[[9,25],[9,-7],[-1,-1],[10,25],[10,-7],[-1,-1],[3,25],[10,25],[-1,-1],[3,-7],[10,-7]]},"^":{width:16,points:[[6,15],[8,18],[10,15],[-1,-1],[3,12],[8,17],[13,12],[-1,-1],[8,17],[8,0]]},_:{width:16,points:[[0,-2],[16,-2]]},"`":{width:10,points:[[6,21],[5,20],[4,18],[4,16],[5,15],[6,16],[5,17]]},a:{width:19,points:[[15,14],[15,0],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},b:{width:19,points:[[4,21],[4,0],[-1,-1],[4,11],[6,13],[8,14],[11,14],[13,13],[15,11],[16,8],[16,6],[15,3],[13,1],[11,0],[8,0],[6,1],[4,3]]},c:{width:18,points:[[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},d:{width:19,points:[[15,21],[15,0],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},e:{width:18,points:[[3,8],[15,8],[15,10],[14,12],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},f:{width:12,points:[[10,21],[8,21],[6,20],[5,17],[5,0],[-1,-1],[2,14],[9,14]]},g:{width:19,points:[[15,14],[15,-2],[14,-5],[13,-6],[11,-7],[8,-7],[6,-6],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},h:{width:19,points:[[4,21],[4,0],[-1,-1],[4,10],[7,13],[9,14],[12,14],[14,13],[15,10],[15,0]]},i:{width:8,points:[[3,21],[4,20],[5,21],[4,22],[3,21],[-1,-1],[4,14],[4,0]]},j:{width:10,points:[[5,21],[6,20],[7,21],[6,22],[5,21],[-1,-1],[6,14],[6,-3],[5,-6],[3,-7],[1,-7]]},k:{width:17,points:[[4,21],[4,0],[-1,-1],[14,14],[4,4],[-1,-1],[8,8],[15,0]]},l:{width:8,points:[[4,21],[4,0]]},m:{width:30,points:[[4,14],[4,0],[-1,-1],[4,10],[7,13],[9,14],[12,14],[14,13],[15,10],[15,0],[-1,-1],[15,10],[18,13],[20,14],[23,14],[25,13],[26,10],[26,0]]},n:{width:19,points:[[4,14],[4,0],[-1,-1],[4,10],[7,13],[9,14],[12,14],[14,13],[15,10],[15,0]]},o:{width:19,points:[[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3],[16,6],[16,8],[15,11],[13,13],[11,14],[8,14]]},p:{width:19,points:[[4,14],[4,-7],[-1,-1],[4,11],[6,13],[8,14],[11,14],[13,13],[15,11],[16,8],[16,6],[15,3],[13,1],[11,0],[8,0],[6,1],[4,3]]},q:{width:19,points:[[15,14],[15,-7],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},r:{width:13,points:[[4,14],[4,0],[-1,-1],[4,8],[5,11],[7,13],[9,14],[12,14]]},s:{width:17,points:[[14,11],[13,13],[10,14],[7,14],[4,13],[3,11],[4,9],[6,8],[11,7],[13,6],[14,4],[14,3],[13,1],[10,0],[7,0],[4,1],[3,3]]},t:{width:12,points:[[5,21],[5,4],[6,1],[8,0],[10,0],[-1,-1],[2,14],[9,14]]},u:{width:19,points:[[4,14],[4,4],[5,1],[7,0],[10,0],[12,1],[15,4],[-1,-1],[15,14],[15,0]]},v:{width:16,points:[[2,14],[8,0],[-1,-1],[14,14],[8,0]]},w:{width:22,points:[[3,14],[7,0],[-1,-1],[11,14],[7,0],[-1,-1],[11,14],[15,0],[-1,-1],[19,14],[15,0]]},x:{width:17,points:[[3,14],[14,0],[-1,-1],[14,14],[3,0]]},y:{width:16,points:[[2,14],[8,0],[-1,-1],[14,14],[8,0],[6,-4],[4,-6],[2,-7],[1,-7]]},z:{width:17,points:[[14,14],[3,0],[-1,-1],[3,14],[14,14],[-1,-1],[3,0],[14,0]]},"{":{width:14,points:[[9,25],[7,24],[6,23],[5,21],[5,19],[6,17],[7,16],[8,14],[8,12],[6,10],[-1,-1],[7,24],[6,22],[6,20],[7,18],[8,17],[9,15],[9,13],[8,11],[4,9],[8,7],[9,5],[9,3],[8,1],[7,0],[6,-2],[6,-4],[7,-6],[-1,-1],[6,8],[8,6],[8,4],[7,2],[6,1],[5,-1],[5,-3],[6,-5],[7,-6],[9,-7]]},"|":{width:8,points:[[4,25],[4,-7]]},"}":{width:14,points:[[5,25],[7,24],[8,23],[9,21],[9,19],[8,17],[7,16],[6,14],[6,12],[8,10],[-1,-1],[7,24],[8,22],[8,20],[7,18],[6,17],[5,15],[5,13],[6,11],[10,9],[6,7],[5,5],[5,3],[6,1],[7,0],[8,-2],[8,-4],[7,-6],[-1,-1],[8,8],[6,6],[6,4],[7,2],[8,1],[9,-1],[9,-3],[8,-5],[7,-6],[5,-7]]},"~":{width:24,points:[[3,6],[3,8],[4,11],[6,12],[8,12],[10,11],[14,8],[16,7],[18,7],[20,8],[21,10],[-1,-1],[3,8],[4,10],[6,11],[8,11],[10,10],[14,7],[16,6],[18,6],[20,7],[21,10],[21,12]]}};function Wr(){for(var e,t,r,n,o,i,a,s,u,c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=c.origin||[0,0,0],h=l[0],f=l[1],d=l[2],p=c.size||1,v=[],m=[],y=((""+c.text).trim()||"").split("\n"),g=0,x=0,b=.04,w=0;w<y.length;w++){e=0,r=(t=y[w]).length;for(var M=0;M<r;M++)if(n=Yr[t.charAt(M)]){o=1,i=-1,a=-1,s=n.points.length;for(var T=0;T<s;T++)-1!==(u=n.points[T])[0]||-1!==u[1]?(v.push(e+u[0]*p*b+h),v.push(x+u[1]*p*b+f),v.push(0+d),-1===i?i=g:(-1===a||(i=a),a=g),g++,o?o=!1:(m.push(i),m.push(a))):o=1;e+=n.width*b*p}x-=35*b*p}return{primitiveType:"lines",positions:v,indices:m}}function Qr(e){for(var t=new ArrayBuffer(e.length),r=new Uint8Array(t),n=0;n<e.length;++n)r[n]=e[n];return t}function Jr(e){return Jr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Jr(e)}function Hr(){Hr=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function c(e,t,r,o){var i=t&&t.prototype instanceof f?t:f,a=Object.create(i.prototype),s=new S(o||[]);return n(a,"_invoke",{value:w(e,r,s)}),a}function l(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var h={};function f(){}function d(){}function p(){}var v={};u(v,i,(function(){return this}));var m=Object.getPrototypeOf,y=m&&m(m(A([])));y&&y!==t&&r.call(y,i)&&(v=y);var g=p.prototype=f.prototype=Object.create(v);function x(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){function o(n,i,a,s){var u=l(e[n],e,i);if("throw"!==u.type){var c=u.arg,h=c.value;return h&&"object"==Jr(h)&&r.call(h,"__await")?t.resolve(h.__await).then((function(e){o("next",e,a,s)}),(function(e){o("throw",e,a,s)})):t.resolve(h).then((function(e){c.value=e,a(c)}),(function(e){return o("throw",e,a,s)}))}s(u.arg)}var i;n(this,"_invoke",{value:function(e,r){function n(){return new t((function(t,n){o(e,r,t,n)}))}return i=i?i.then(n,n):n()}})}function w(e,t,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return{value:void 0,done:!0}}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var s=M(a,r);if(s){if(s===h)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=l(e,t,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===h)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}function M(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,M(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),h;var o=l(n,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,h;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,h):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,h)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function I(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function A(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:O}}function O(){return{value:void 0,done:!0}}return d.prototype=p,n(g,"constructor",{value:p,configurable:!0}),n(p,"constructor",{value:d,configurable:!0}),d.displayName=u(p,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===d||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,u(e,s,"GeneratorFunction")),e.prototype=Object.create(g),e},e.awrap=function(e){return{__await:e}},x(b.prototype),u(b.prototype,a,(function(){return this})),e.AsyncIterator=b,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new b(c(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},x(g),u(g,s,"Generator"),u(g,i,(function(){return this})),u(g,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=A,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(I),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,h):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),I(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;I(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:A(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),h}},e}function $r(e,t,r,n,o,i,a){try{var s=e[i](a),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}var en=r(231);function tn(e){var t=e.WebIFC,r=e.configs,n=e.source,o=e.sourceData,i=e.sourceFormat,a=e.metaModelSource,s=e.metaModelDataStr,u=e.output,c=e.outputXKTModel,l=e.outputXKT,h=e.includeTypes,d=e.excludeTypes,p=e.reuseGeometries,v=void 0===p||p,m=e.minTileSize,y=void 0===m?200:m,g=e.stats,x=void 0===g?{}:g,b=e.outputStats,w=e.rotateX,M=void 0!==w&&w,T=e.includeTextures,I=void 0===T||T,S=e.includeNormals,A=void 0===S||S,O=e.log,L=void 0===O?function(e){}:O;return x.sourceFormat="",x.schemaVersion="",x.title="",x.author="",x.created="",x.numMetaObjects=0,x.numPropertySets=0,x.numTriangles=0,x.numVertices=0,x.numNormals=0,x.numUVs=0,x.numTextures=0,x.numTextureSets=0,x.numObjects=0,x.numGeometries=0,x.sourceSize=0,x.xktSize=0,x.texturesSize=0,x.xktVersion="",x.compressionRatio=0,x.conversionTime=0,x.aabb=null,new Promise((function(e,p){var m=L;if(L=function(e){m("[convert2xkt] ".concat(e))},n||o)if(i||!o)if(u||c||l){n&&L("Reading input file: "+n);var g=new Date,w=r.sourceConfigs||{},T=i||n.split(".").pop(),S=w[T];if(S||(L('[WARNING] Could not find configs sourceConfigs entry for source format "'.concat(T,'". This is derived from the source file name extension. Will use internal default configs.')),S={}),!o)try{o=en.readFileSync(n)}catch(e){return void p(e)}var O,P=o.byteLength;if(L("Input file size: "+(P/1e3).toFixed(2)+" kB"),!s&&a){L("Reading input metadata file: "+a);try{s=en.readFileSync(a)}catch(e){return void p(e)}}else L("Not embedding metadata in XKT");if(s)try{O=JSON.parse(s)}catch(e){L("Error parsing metadata JSON: ".concat(e))}y=D(S.minTileSize,y),M=D(S.rotateX,M),v=D(S.reuseGeometries,v),I=D(S.includeTextures,I),A=D(S.includeNormals,A),h=D(S.includeTypes,h),d=D(S.excludeTypes,d),!1===v&&L("Geometry reuse is disabled");var E,j,G=new He({minTileSize:y});switch(T){case"json":N(Ft,{data:JSON.parse(o),xktModel:G,stats:x,rotateX:M,center:S.center,transform:S.transform,log:L});break;case"glb":N(Wt,{data:o=Qr(o),reuseGeometries:v,includeTextures:I,includeNormals:A,metaModelData:O,xktModel:G,stats:x,log:L});break;case"gltf":var k=JSON.parse(o),_=n?rn(n):"";N(ar,{baseUri:_,data:k,reuseGeometries:v,includeTextures:I,includeNormals:A,metaModelData:O,xktModel:G,getAttachment:(E=Hr().mark((function e(t){var r,n,o;return Hr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return L("Reading attachment file: ".concat(r=_+t)),n=en.readFileSync(r),o=Qr(n),e.abrupt("return",o);case 5:case"end":return e.stop()}}),e)})),j=function(){var e=this,t=arguments;return new Promise((function(r,n){var o=E.apply(e,t);function i(e){$r(o,r,n,i,a,"next",e)}function a(e){$r(o,r,n,i,a,"throw",e)}i(void 0)}))},function(e){return j.apply(this,arguments)}),stats:x,log:L});break;case"ifc":N(vr,{WebIFC:t,data:o,xktModel:G,wasmPath:"./",includeTypes:h,excludeTypes:d,stats:x,log:L});break;case"laz":case"las":N(wr,{data:o,xktModel:G,stats:x,fp64:S.fp64,colorDepth:S.colorDepth,center:S.center,transform:S.transform,skip:D(S.skip,1),log:L});break;case"pcd":N(Tr,{data:o,xktModel:G,stats:x,log:L});break;case"ply":N(Lr,{data:o,xktModel:G,stats:x,log:L});break;case"stl":N(kr,{data:o,xktModel:G,stats:x,log:L});break;default:return void p('Error: unsupported source format: "'.concat(T,'".'))}}else p("Argument expected: output, outputXKTModel or outputXKT");else p("Argument expected: sourceFormat is required with sourceData");else p("Argument expected: source or sourceData");function D(e,t){return void 0!==e?e:t}function N(t,r){t(r).then((function(){O||G.createDefaultMetaObjects(),L("Input file parsed OK. Building XKT document..."),G.finalize().then((function(){L("XKT document built OK. Writing to XKT file...");var t=nt(G,O,x,{zip:!0}),r=Buffer.from(t),n=t.byteLength;if(x.minTileSize=y||200,x.sourceSize=(P/1e3).toFixed(2),x.xktSize=(n/1e3).toFixed(2),x.xktVersion=f.xktVersion,x.compressionRatio=(P/n).toFixed(2),x.conversionTime=((new Date-g)/1e3).toFixed(2),x.aabb=G.aabb,L("Converted to: XKT v".concat(x.xktVersion)),h&&L("Include types: "+(h||"(include all)")),d&&L("Exclude types: "+(d||"(exclude none)")),L("XKT size: "+x.xktSize+" kB"),L("XKT textures size: "+(x.texturesSize/1e3).toFixed(2)+"kB"),L("Compression ratio: "+x.compressionRatio),L("Conversion time: "+x.conversionTime+" s"),L("Converted metaobjects: "+x.numMetaObjects),L("Converted property sets: "+x.numPropertySets),L("Converted drawable objects: "+x.numObjects),L("Converted geometries: "+x.numGeometries),L("Converted textures: "+x.numTextures),L("Converted textureSets: "+x.numTextureSets),L("Converted triangles: "+x.numTriangles),L("Converted vertices: "+x.numVertices),L("Converted UVs: "+x.numUVs),L("Converted normals: "+x.numNormals),L("minTileSize: "+x.minTileSize),u){var o=rn(u).trim();""===o||en.existsSync(o)||en.mkdirSync(o,{recursive:!0}),L("Writing XKT file: "+u),en.writeFileSync(u,r)}c&&c(G),l&&l(r),b&&b(x),e()}))}),(function(e){p(e)}))}}))}function rn(e){var t=e.lastIndexOf("/");return 0!==t?e.substring(0,t+1):""}(0,e.installFilePolyfills)()})(),n})()));
//# sourceMappingURL=xeokit-convert.cjs.js.map